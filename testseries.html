<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPSChub Test</title>
    <style>
        #test-container { max-width: 800px; margin: 0 auto; }
        #timer { font-size: 2em; margin-bottom: 20px; }
        #submit-btn { display: none; }
        #offline-warning { color: red; font-weight: bold; }
        #google-form-container { width: 100%; height: 600px; }
    </style>
</head>
<body>
    <div id="test-container">
        <h1>UPSChub Test</h1>
        <div id="timer">Timer: 00:00</div>
        <p>Test Instructions: Answer the questions below. You cannot submit until you're online.</p>

        <!-- Google Form Embed -->
        <div id="google-form-container">
            <iframe id="google-form" 
                    src="https://docs.google.com/forms/d/e/1FAIpQLScBEdgbKDGmVM4M3Ep3sPgIZaFDabWZPwr7rDEGYxPKxywoZw/viewform?embedded=true" 
                    width="100%" height="100%" frameborder="0">
            </iframe>
        </div>

        <div id="offline-warning">You are offline. Please reconnect to the internet before submitting.</div>
        <button id="submit-btn" onclick="submitTest()">Submit Test</button>
    </div>

    <script>
        let timer;
        let timeLeft = 10 * 60; // 10 minutes timer (in seconds)
        let isOnline = navigator.onLine;
        let examStarted = false;

        // Function to detect if Airplane Mode is on
        function checkAirplaneMode() {
            // Simulate Airplane Mode by checking for an offline connection (no network)
            if (!navigator.onLine && !examStarted) {
                alert("Please turn on Airplane Mode to start the exam.");
                return false; // Exam cannot start unless Airplane Mode is enabled
            }
            return true; // Exam can start
        }

        // Show or hide the offline warning based on internet connectivity
        function updateInternetStatus() {
            if (navigator.onLine) {
                document.getElementById("offline-warning").style.display = "none";
                document.getElementById("submit-btn").style.display = "block"; // Show the submit button if online
                isOnline = true;
            } else {
                document.getElementById("offline-warning").style.display = "block";
                document.getElementById("submit-btn").style.display = "none"; // Hide submit if offline
                isOnline = false;
            }
        }

        // Countdown timer logic
        function startTimer() {
            timer = setInterval(function() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById("timer").textContent = `Timer: ${formatTime(minutes)}:${formatTime(seconds)}`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    alert("Time is up!");
                    autoSubmitTest(); // Auto-submit the test when time is up
                }
                timeLeft--;
            }, 1000);
        }

        function formatTime(time) {
            return time < 10 ? "0" + time : time;
        }

        // Function to auto-submit the test when time runs out
        function autoSubmitTest() {
            if (!isOnline) {
                alert("You need to turn on the internet to submit the test.");
                return;
            }
            alert("Test submitted automatically.");
            submitTest();
        }

        // Function to manually submit the test when the user clicks submit button
        function submitTest() {
            if (!isOnline) {
                alert("Please reconnect to the internet before submitting.");
                return;
            }
            alert("Test submitted successfully!");
            // Simulate form submission or integration with Google Sheets backend
        }

        // Detect changes in internet connection
        window.addEventListener("online", updateInternetStatus);
        window.addEventListener("offline", updateInternetStatus);

        // Initialize the process
        if (checkAirplaneMode()) {
            examStarted = true;
            startTimer(); // Start the exam timer when Airplane Mode is confirmed
        }

        updateInternetStatus(); // Initialize the internet status
    </script>
</body>
</html>
