<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UPSChub - Exam Portal</title>
  <link rel="icon" type="images\jpg" href="images\LOGO.jpg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* General Styles & Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; }
    body { font-family: 'Poppins', sans-serif; background: #f0f0f5; color: #333; transition: background-color 0.3s ease, color 0.3s ease; position: relative; }
    .dark { background: #1e1e2f; color: #eee; }

    /* Full-Page Watermark - Activated During Exam */
  /* General Styles & Reset */
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }
body { font-family: 'Poppins', sans-serif; background: #f0f0f5; color: #333; transition: background-color 0.3s ease, color 0.3s ease; position: relative; }
.dark { background: #1e1e2f; color: #eee; }

/* Full-Page Watermark - Activated During Exam */
body.exam-active::after {
    content: "UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A
              UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A";
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    font-size: 8vw;
    font-weight: 700;
    color: rgba(0, 0, 0, 0.05);
    text-align: center;
    line-height: 2;
    transform-origin: center;
    transform: rotate(-30deg);
    z-index: 9999;
    pointer-events: none;
    white-space: pre-wrap;
    overflow: hidden;
}

.site-header {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    padding: 10px 15px;
}

.site-logo {
    max-height: 40px;
}

.site-copyright {
    font-family: "Trebuchet MS", "Segoe UI", Arial, sans-serif;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.8px;
    white-space: nowrap;
    transition: color 0.3s ease;
}

/* 🌞 Light mode */
body.light-mode .site-copyright {
    color: rgba(0, 0, 0, 0.6);
}

/* 🌙 Dark mode */
body.dark-mode .site-copyright {
    color: rgba(255, 255, 255, 0.7);
}

/* 📱 Mobile view fix */
@media (max-width: 600px) {
    .site-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .site-copyright {
        margin-top: 5px;
        position: static;
    }
}


.dark.exam-active::after { color: rgba(255, 255, 255, 0.04); }

/* STAGE 1 & 2: Login & Instructions Screens */
.pre-exam-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; z-index: 5000; position: relative; background: #f0f0f5;}
.dark .pre-exam-screen { background: #1e1e2f; }

.login-card, .instructions-container {
    background: #ffffff; padding: 30px 40px; border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); width: 100%; text-align: center;
}
.dark .login-card, .dark .instructions-container { background: #2a2a3a; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }

#loginScreen .login-card { max-width: 450px; }
.login-card h2 { margin-bottom: 25px; color: #3f51b5; font-size: 1.8em; }
.dark .login-card h2 { color: #8ab4f8; }
.input-group { margin-bottom: 20px; text-align: left; }
.input-group label { display: block; margin-bottom: 5px; font-weight: 500; }
.input-group input { width: 100%; padding: 12px 15px; border: 1px solid #ccc; border-radius: 6px; font-size: 1em; }
.dark .input-group input { background: #1e1e2f; border-color: #555; color: #eee; }
.btn-primary { width: 100%; padding: 12px; border: none; border-radius: 6px; background: #3f51b5; color: white; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: background 0.3s; }
.btn-primary:hover:not(:disabled) { opacity: 0.9; }
#loginError { color: #f44336; height: 1.2em; margin-top: 15px; font-weight: 500; }

#instructionsScreen { display: none; }
#instructionsScreen .instructions-container { max-width: 800px; text-align: left; height: 90vh; display: flex; flex-direction: column; }
#instructionsScreen h2 { color: #3f51b5; border-bottom: 2px solid #3f51b5; padding-bottom: 5px; margin-bottom: 15px; margin-top: 25px; }
#instructionsScreen h2:first-of-type { margin-top: 0; }
.dark #instructionsScreen h2 { color: #8ab4f8; border-bottom-color: #8ab4f8; }
.instructions-content { flex-grow: 1; overflow-y: auto; padding-right: 15px; }
.instructions-content ul { list-style: none; padding-left: 0; line-height: 1.8; }
.instructions-content li { display: flex; align-items: flex-start; margin-bottom: 12px; }
.instructions-content li i { color: #3f51b5; margin-right: 15px; font-size: 1.2em; margin-top: 5px; min-width: 20px; text-align: center; }
.dark .instructions-content li i { color: #8ab4f8; }
.instructions-content strong { color: #c62828; }
.dark .instructions-content strong { color: #ef9a9a; }
.instructions-footer { padding-top: 20px; border-top: 1px solid #eee; }
.dark .instructions-footer { border-top-color: #444; }
#offlineStatus { font-weight: 600; text-align: center; padding: 10px; border-radius: 6px; margin-bottom: 15px; }
.status-waiting { background: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
.status-ready { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
.agreement-group { display: flex; align-items: center; margin-bottom: 15px; }
#agreementCheckbox { width: 18px; height: 18px; margin-right: 10px; cursor: pointer; }
#agreementCheckbox + label { font-size: 0.9em; cursor: pointer; }
.btn-start-exam:disabled { background: #9fa8da; cursor: not-allowed; }
.dark .btn-start-exam:disabled { background: #2c3a7a; }
#startError { color: #d32f2f; text-align: center; height: 1.2em; font-weight: 500; }

/* STAGE 3: EXAM UI STYLES */
#examUIWrapper { display: none; flex-direction: column; height: 100%; position: relative; }
.site-header { background: #ffffff; padding: 10px 20px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #e0e0e0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); z-index: 101; position: relative; }
.site-logo { height: 40px; width: auto; }
.site-branding .site-title { font-size: 1.4em; font-weight: 700; color: #3f51b5; line-height: 1.1; }
.site-branding .site-tagline { font-size: 0.8em; color: #666; margin: 0; }
.topbar { display: flex; align-items: center; justify-content: space-between; padding: 8px 20px; background: #3f51b5; color: white; gap: 10px; z-index: 100; position: relative; }
.topbar-left-group, .topbar-right-group { display: flex; align-items: center; gap: 15px; }
.navigation-tabs { display: flex; gap: 5px; background: rgba(0,0,0,0.15); border-radius: 6px; padding: 3px; position: absolute; left: 50%; transform: translateX(-50%); }
.nav-tab { background: transparent; border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-weight: 500; transition: all 0.3s; font-size: 0.85em; }
.nav-tab:hover:not(.locked) { background: rgba(255,255,255,0.2); }
.nav-tab.active { background: white; color: #3f51b5; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.nav-tab.locked { cursor: not-allowed; opacity: 0.6; position: relative; pointer-events: none; }
.nav-tab.locked::after { content: '\f023'; font-family: "Font Awesome 6 Free"; font-weight: 900; margin-left: 8px; font-size: 0.9em; }
.timer { font-size: 0.95em; font-weight: bold; white-space: nowrap; background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px; }
#stopwatchWrapper { display: none; align-items: center; gap: 10px; }
#stopwatchDisplay { font-size: 0.95em; font-weight: bold; white-space: nowrap; background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px; }
.stopwatch-controls button { background: transparent; border: 1px solid rgba(255,255,255,0.3); color: white; cursor: pointer; font-size: 0.8em; padding: 5px; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; margin-left: 5px; }
.stopwatch-controls button:hover { background-color: rgba(255,255,255,0.2); }
.dark-mode-toggle { display: flex; align-items: center; gap: 8px; }
.toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .toggle-slider { background-color: #4caf50; }
input:checked + .toggle-slider:before { transform: translateX(24px); }
.toggle-label { font-size: 0.9em; white-space: nowrap; }
.topbar #btnSubmitTest { background: #f44336; color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 0.85em; padding: 8px 15px; }
.topbar #btnSubmitTest:hover { opacity: 0.85; }
.main-content { flex: 1; display: flex; overflow: hidden; position: relative; z-index: 5; }
.question-area { width: 100%; padding: 20px; overflow-y: auto; padding-bottom: 100px; transition: padding-right 0.3s ease, filter 0.3s ease; position: relative; z-index: 5; }
.sidebar-open .question-area { filter: blur(4px); pointer-events: none; }
.question-header { font-size: 1.2em; margin-bottom: 15px; font-weight: 600; }
.question-timer-bar-container { width: 100%; height: 8px; background-color: #e0e0e0; border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
.question-timer-bar { height: 100%; width: 100%; background-color: #3f51b5; border-radius: 4px; }
.dark .question-timer-bar-container { background-color: #3d3d4a; }
.dark .question-timer-bar { background-color: #8ab4f8; }
.question-content { margin-bottom: 20px; line-height: 1.6; font-size: 1em; }
.options-list { list-style: none; display: grid; grid-template-columns: 1fr; gap: 10px; padding: 0; }
.option { padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.2s; background: white; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-size: 0.95em; position: relative; }
.option:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
.option.selected { background: #4caf50; color: white; border-color: #4caf50; box-shadow: 0 2px 5px rgba(76,175,80,0.3); }
.option-radio { margin-right: 12px; min-width: 18px; height: 18px; border: 2px solid #ccc; border-radius: 50%; display: inline-block; position: relative; }
.option.selected .option-radio { border-color: white; background: white; box-shadow: inset 0 0 0 4px #4caf50; }

.sidebar { position: fixed; top: 111px; right: -300px; width: 300px; height: calc(100% - 111px); background: #f8f9fa; border-left: 1px solid #ccc; display: flex; flex-direction: column; transition: right 0.3s ease-in-out; z-index: 200; box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
.sidebar-open .sidebar { right: 0; }
.sidebar-content { padding: 15px; overflow-y: auto; flex-grow: 1;}
.palette-title { font-weight: 600; margin-bottom: 10px; color: #3f51b5; font-size: 1.1em; text-align: center; }
.question-palette { display: grid; grid-template-columns: repeat(auto-fill, minmax(35px, 1fr)); gap: 8px; margin-bottom: 20px; }
.question-number { width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid transparent; cursor: pointer; font-weight: 500; transition: all 0.2s; font-size: 13px; margin: 0 auto; }
.question-number:hover { transform: scale(1.1); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
.answered { background: #4caf50; color: white; border: 1px solid #388e3c;}
.not-answered { background: #f44336; color: white; border: 1px solid #d32f2f;}
.marked { background: #ff9800; color: white; border: 1px solid #f57c00;}
.marked-answered { background: linear-gradient(135deg, #4caf50 50%, #ff9800 50%); color: white; border: 1px solid #f57c00; }
.not-visited { background: #e9ecef; color: #333; border: 1px solid #ddd;}
.current { border: 2px solid #3f51b5; transform: scale(1.1); }
.palette-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; padding: 12px; background: #e0e0e0; border-radius: 6px; font-size: 0.8em; }
.summary-item { display: flex; align-items: center; gap: 8px; color: #333; }
.summary-item span { font-weight: 700; background-color: #fff; border-radius: 50%; min-width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center; text-align: center; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
.legend { margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;}
.legend-title { font-weight: 600; margin-bottom: 12px; color: #3f51b5; font-size: 1em; }
.legend-item { display: flex; align-items: center; margin-bottom: 8px; font-size: 0.85em; padding: 6px 8px; border-radius: 4px; }
.legend-color { width: 16px; height: 16px; border-radius: 3px; margin-right: 10px; flex-shrink: 0; }
.legend-answered { background: #4caf50; }
.legend-not-answered { background: #f44336; }
.legend-marked { background: #ff9800; }
.legend-marked-answered { background: linear-gradient(135deg, #4caf50 50%, #ff9800 50%); }
.legend-not-visited { background: #e9ecef; border: 1px solid #ccc; }

.sidebar-toggle { background: transparent; border: 1px solid rgba(255,255,255,0.3); color: white; cursor: pointer; font-size: 0.9em; padding: 5px; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
.sidebar-toggle:hover { background-color: rgba(255,255,255,0.2); }
.sidebar-open .sidebar-toggle { transform: rotate(180deg); }

.fixed-action-area { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #ccc; padding: 10px 15px; z-index: 100; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
.action-buttons { display: flex; justify-content: center; align-items: center; gap: 8px; }
.btn-action { padding: 8px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.85em; flex-grow: 1; flex-basis: 0; }
.btn-action:hover { opacity: 0.85; }
#btnPrevQuestion { background: #6c757d; color: white; }
#btnSaveNext { background: #4caf50; color: white; }
#btnMarkReview { background: #ff9800; color: white; }
#btnClearResponse { background: #f44336; color: white; }
.submit-button.btn-action { background: #3f51b5; color: white; padding: 10px 25px; flex-grow: 0; }

/* Result Screen & Animated Scorecard Styles */
#resultScreenWrapper { display: none; text-align: center; padding: 20px; flex-direction: column; align-items: center; justify-content: flex-start; flex: 1; overflow-y: auto; position: relative;}
#resultScreenWrapper h2 { font-size: 2.5em; color: #3f51b5; margin-bottom: 5px; }
#resultScreenWrapper p { font-size: 1.2em; margin-bottom: 20px; }
.scorecard-details { width: 100%; max-width: 500px; margin: 25px auto; background: #ffffff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.scorecard-table { width: 100%; border-collapse: collapse; font-size: 1.1em; }
.scorecard-table td { padding: 12px 15px; border-bottom: 1px solid #f0f0f0; }
.scorecard-table tr:last-child td { border-bottom: none; }
.scorecard-table td:first-child { text-align: left; font-weight: 500; color: #555; }
.scorecard-table td:last-child { text-align: right; font-weight: 700; }
.scorecard-table .correct-val { color: #4caf50; }
.scorecard-table .incorrect-val { color: #f44336; }
.scorecard-table .unattempted-val { color: #ff9800; }
.scorecard-table .total-row td { font-size: 1.2em; border-top: 2px solid #e0e0e0; padding-top: 15px; margin-top: 5px; }
.scorecard-table .total-val { color: #3f51b5; }
.dark .scorecard-details { background: #2a2a3a; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
.dark .scorecard-table td { border-bottom-color: #3a3a4a; }
.dark .scorecard-table td:first-child { color: #ccc; }
.dark .scorecard-table .correct-val { color: #81c784; }
.dark .scorecard-table .incorrect-val { color: #ef9a9a; }
.dark .scorecard-table .unattempted-val { color: #ffd54f; }
.dark .scorecard-table .total-row td { border-top-color: #555; }
.dark .scorecard-table .total-val { color: #8ab4f8; }

#finalScore { display: none; }
.result-buttons { display: flex; gap: 15px; margin-top: 30px; margin-bottom: 30px; }
.performance-analysis-container { width: 100%; max-width: 800px; margin: 30px auto; background: #ffffff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.chart-container { width: 100%; max-width: 800px; margin: 30px auto; background: #ffffff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.performance-analysis-container h3 { text-align: center; margin-bottom: 20px; font-size: 1.5em; color: #3f51b5; }
.table-wrapper { overflow-x: auto; }
.performance-table { width: 100%; border-collapse: collapse; }
.performance-table th, .performance-table td { padding: 14px 10px; text-align: center; border-bottom: 1px solid #e0e0e0; font-size: 0.95em; white-space: nowrap; }
.performance-table th { background-color: #f8f9fa; font-weight: 600; color: #444; }
.performance-table td:first-child { text-align: left; font-weight: 500; width: 40%; white-space: normal; }
.accuracy-bar-container { background-color: #e9ecef; border-radius: 10px; position: relative; height: 22px; overflow: hidden; min-width: 100px; }
.accuracy-bar { height: 100%; border-radius: 10px; transition: width 0.8s ease-in-out; }
.accuracy-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 600; font-size: 0.9em; color: #333; text-shadow: 0 0 2px rgba(255,255,255,0.7); }
#performanceChart { width: 100% !important; height: 350px !important; }

/* Review Screen & Explanation Styles */
#reviewScreenWrapper { display: none; width: 100%; flex-direction: column; position: relative;}
.review-header { padding: 15px 20px; background: #fff; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; }
#reviewContainer { padding: 20px; overflow-y: auto; flex-grow: 1; background-color: #f0f0f5; }
.review-question { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.review-option-list { list-style: none; padding: 0; margin-top: 15px; }
.review-option { padding: 10px 15px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #e0e0e0; display: flex; align-items: center; gap: 12px; }
.review-option i { min-width: 1.2em; text-align: center; }
.review-option.review-correct { background-color: #e8f5e9; border-color: #a5d6a7; color: #1b5e20; font-weight: 500; }
.review-option.review-incorrect { background-color: #ffebee; border-color: #ef9a9a; color: #b71c1c; }
.review-status { margin-top: 15px; padding: 8px 12px; border-radius: 6px; font-weight: 500; text-align: center; border: 1px solid transparent; }
.review-status.correct { background-color: #e8f5e9; border-color: #a5d6a7; color: #1b5e20; }
.review-status.incorrect { background-color: #ffebee; border-color: #ef9a9a; color: #c62828; }
.review-status.unanswered { background-color: #fff3e0; border-color: #ffcc80; color: #e65100; }
.review-explanation { margin-top: 20px; padding: 15px; background: #eef2ff; border-left: 4px solid #3f51b5; border-radius: 4px; font-size: 0.9em; line-height: 1.6; }
.review-explanation strong { color: #3f51b5; }

.password-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center;}
.modal-content { background-color: #fefefe; padding: 25px 35px; border: 1px solid #888; width: 90%; max-width: 420px; border-radius: 12px; text-align: center; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
.close-modal { position: absolute; top: 10px; right: 20px; font-size: 1.8em; color: #aaa; cursor: pointer; transition: color 0.2s; }
.close-modal:hover { color: #333; }
#passwordRetestInput { width: 100%; padding: 10px; margin: 15px 0; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
#passwordError { color: #f44336; font-size: 0.9em; height: 1.2em; margin-bottom: 10px;}
.contact-admin-text { margin-top: 20px; font-size: 0.9em; color: #666; }
.contact-admin-text a { color: #3f51b5; text-decoration: none; font-weight: 500; }
.contact-admin-text a:hover { text-decoration: underline; }

/* Styles for the new Answer Writing Section */
#answerWritingWrapper {
    display: none;
    flex: 1;
    flex-direction: column; /* Changed to column */
    align-items: center;
    justify-content: flex-start; /* Aligned to the top */
    padding: 40px 20px;
    position: relative;
    overflow-y: auto; /* Added for scrollability */
}

#answerWritingWrapper h2 {
    color: #3f51b5;
    font-size: 1.8em;
    margin-bottom: 10px;
}

#answerWritingWrapper h3 {
    color: #4a4a4a;
    font-size: 1.4em;
    margin-top: 30px;
    margin-bottom: 15px;
    border-bottom: 2px solid #ccc;
    padding-bottom: 5px;
}

#answerWritingWrapper p {
    color: #555;
    font-size: 1.1em;
    line-height: 1.6;
}

#answerWritingWrapper ul,
#answerWritingWrapper ol {
    max-width: 800px;
    width: 100%;
    margin: 20px auto;
    text-align: left;
    padding-left: 20px;
}

#answerWritingWrapper li {
    margin-bottom: 15px;
    line-height: 1.6;
    font-size: 1em;
}

#answerWritingWrapper strong {
    color: #3f51b5;
}


/* Dark Mode Overrides */
.dark .site-header { background: #2a2a3a; border-bottom-color: #3a3a4a; }
.dark .site-branding .site-title { color: #8ab4f8; }
.dark .site-branding .site-tagline { color: #aaa; }
.dark .option { background: #2c2c3c; border-color: #444; color: #eee; }
.dark .option:hover { background: #3d3d4a; }
.dark .option.selected { background: #1b5e20; color: #c8e6c9; border-color: #81c784; }
.dark .option.selected .option-radio { border-color: #c8e6c9; background: #c8e6c9; box-shadow: inset 0 0 0 4px #1b5e20; }
.dark .option-radio { border-color: #555; }
.dark .fixed-action-area { background: #1e1e2f; border-top-color: #444;}
.dark .sidebar { background: #2a2a3a; border-left: 1px solid #444;}
.dark .not-visited { background: #3d3d4a; color: #eee; border: 1px solid #555; }
.dark .palette-summary { background: #1e1e2f; border: 1px solid #444;}
.dark .summary-item { color: #ccc; }
.dark .summary-item span { background-color: #3d3d4a; color: #eee; }
.dark .legend, .dark .fixed-action-area { border-top-color: #444; }
.dark .legend-item { background: rgba(255,255,255,0.05); }
.dark .palette-title, .dark .legend-title { color: #8ab4f8; }
.dark #resultScreenWrapper h2, .dark .performance-analysis-container h3, .dark .review-title, .dark #answerWritingWrapper h2, .dark #answerWritingWrapper h3 { color: #8ab4f8; }
.dark #answerWritingWrapper p { color: #aaa; }
.dark #answerWritingWrapper li strong { color: #8ab4f8; }
.dark .performance-analysis-container, .dark .chart-container { background: #2a2a3a; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
.dark .performance-table th { background-color: #1e1e2f; color: #ccc; }
.dark .performance-table td { border-bottom: 1px solid #444; }
.dark .accuracy-bar-container { background-color: #3d3d4a; }
.dark .accuracy-text { color: #fff; text-shadow: none; }
.dark .review-header { background: #2a2a3a; border-color: #444; }
.dark #reviewContainer { background-color: #1e1e2f; }
.dark .review-question { background: #2c2c3c; border-color: #444; }
.dark .review-option { border-color: #555; }
.dark .review-option.review-correct { background-color: #1a311b; border-color: #81c784; color: #c8e6c9; }
.dark .review-option.review-incorrect { background-color: #3e1c1f; border-color: #ef9a9a; color: #ffcdd2; }
.dark .review-status.correct { background-color: #1a311b; border-color: #4caf50; color: #c8e6c9; }
.dark .review-status.incorrect { background-color: #3e1c1f; border-color: #f44336; color: #ffcdd2; }
.dark .review-status.unanswered { background-color: #4a2c0f; border-color: #ff9800; color: #ffe0b2; }
.dark .review-explanation { background: #262a42; border-left-color: #8ab4f8; color: #ccc; }
.dark .review-explanation strong { color: #8ab4f8; }
.dark .modal-content { background: #2c2c3c; border-color: #555; }
.dark .close-modal:hover { color: #fff; }
.dark .contact-admin-text { color: #aaa; }
.dark .contact-admin-text a { color: #8ab4f8; }

@media (max-width: 768px) {
    .site-header { flex-direction: column; text-align: center; gap: 5px; }
    .topbar { flex-wrap: wrap; justify-content: center; }
    .navigation-tabs { position: static; transform: none; order: 3; width: 100%; justify-content: center; margin-top: 10px; }
    .sidebar-open .question-area { padding-right: 20px; }
}
@media (max-width: 480px) {
    .btn-action span { display: none; }
    .btn-action .fas { font-size: 1.1em; margin: 0 5px; }
}
  </style>
</head>
<body>

  <!-- STAGE 1: LOGIN SCREEN (Visible by default) -->
  <div id="loginScreen" class="pre-exam-screen" style="display: flex;">
    <div class="login-card">
        <h2>Exam Portal Login</h2>
        <div class="input-group"> <label for="userIdInput">User ID</label> <input type="text" id="userIdInput" value="UPSC2025"> </div>
        <div class="input-group"> <label for="passwordLoginInput">Password</label> <input type="password" id="passwordLoginInput" value="UPSChub@123"> </div>
        <button id="loginBtn" class="btn-primary">Login</button>
        <p id="loginError"></p>
    </div>
  </div>

  <!-- STAGE 2: INSTRUCTIONS & SYSTEM CHECK SCREEN (Hidden by default) -->
  <div id="instructionsScreen" class="pre-exam-screen">
      <div class="instructions-container">
          <div class="instructions-content">
              <h2>General Instructions:</h2>
              <ul>
                  <li><i class="fas fa-list-ol"></i><div>Total Questions: <strong id="totalQuestionsEl">50</strong>.</div></li>
                  <li><i class="fas fa-clock"></i><div>Total Duration: <strong>60 Minutes</strong>.</div></li>
                  <li><i class="fas fa-stopwatch-20"></i><div>Each question has a <strong>10-second timer</strong>. The test will automatically move to the next question when this timer ends.</div></li>
                   <li><i class="fas fa-calculator"></i><div>Marking Scheme: <strong>+1</strong> for a correct answer, <strong>-1</strong> for an incorrect answer, and <strong>0</strong> for an unattempted question.</div></li>
              </ul>
              <h2>Security & Environment:</h2>
              <ul>
                  <li><i class="fas fa-plane-departure"></i><div>You must take this exam in an offline environment. Please <strong>Enable Aeroplane/Flight Mode</strong> before starting.</div></li>
                  <li><i class="fas fa-wifi-slash"></i><div>If an internet connection is detected after starting, your test will be <strong>auto-submitted</strong>. This action is final.</div></li>
                  <li><i class="fas fa-window-close"></i><div>Do not close or refresh the browser window, as this will end your test.</div></li>
              </ul>
              <h2>Navigation Instructions:</h2>
              <ul>
                  <li><i class="fas fa-check" style="color:#4caf50;"></i><div>Click <strong>Save & Next</strong> to save your answer and move to the next question.</div></li>
                  <li><i class="fas fa-flag" style="color:#ff9800;"></i><div>Click <strong>Mark</strong> to mark a question for review.</div></li>
                  <li><i class="fas fa-square" style="color:#f44336;"></i><div>A <strong>Red</strong> number in the palette means you have visited but not answered the question.</div></li>
              </ul>
          </div>
          <div class="instructions-footer">
              <div id="offlineStatus" class="status-waiting"><i class="fas fa-wifi"></i> Please enable Aeroplane Mode.</div>
              <div class="agreement-group">
                  <input type="checkbox" id="agreementCheckbox">
                  <label for="agreementCheckbox">I have read all the instructions and I am ready to begin.</label>
              </div>
              <button id="startExamBtn" class="btn-primary btn-start-exam" disabled>Start Exam</button>
              <div id="startError"></div>
          </div>
      </div>
  </div>

  <!-- STAGE 3: EXAM UI WRAPPER (Hidden by default) -->
<div id="examUIWrapper">
    <header class="site-header" id="siteHeader">
        <img src="images\LOGO.jpg" alt="UPSChub Logo" class="site-logo">
        <div class="site-branding">
            <div class="site-title">UPSChub</div>
            <p class="site-tagline">Civil Services Exam Preparation</p>
        </div>
        <div class="site-copyright">Copyright © 2025 Pratyush Swain</div>
    </header>

    <header class="topbar" id="topbar">
      <div class="topbar-left-group">
        <button id="btnToggleSidebar" class="sidebar-toggle" title="Toggle Palette"><i class="fas fa-chevron-left"></i></button>
        <div class="timer" id="timer">02:30:00</div>
        <div id="stopwatchWrapper">
          <span id="stopwatchDisplay">00:00:00</span>
          <div class="stopwatch-controls">
            <button id="stopwatchPlayPause" title="Play/Pause"><i class="fas fa-play"></i></button>
            <button id="stopwatchReset" title="Reset"><i class="fas fa-rotate-left"></i></button>
          </div>
        </div>
      </div>
      <div class="navigation-tabs">
        <button id="showMockTestTab" class="nav-tab active">Mock Test</button>
        <button id="showAnswerWritingTab" class="nav-tab locked">Answer Writing</button>
      </div>
      <div class="topbar-right-group">
        <div class="dark-mode-toggle">
          <span class="toggle-label" id="toggleLabel">Dark</span>
          <label class="toggle-switch"><input type="checkbox" id="darkModeToggle"><span class="toggle-slider"></span></label>
        </div>
        <button id="btnSubmitTest" style="display: none;"><i class="fas fa-paper-plane"></i> Submit</button>
      </div>
    </header>
    <div class="main-content">
        <div id="mockTestWrapper" style="display: flex; width: 100%;">
            <section class="question-area">
                <h2 class="question-header" id="questionNumber"></h2>
                <div class="question-timer-bar-container"><div id="questionTimerBar" class="question-timer-bar"></div></div>
                <div class="question-content" id="questionText"></div>
                <ul class="options-list" id="optionsList"></ul>
            </section>
            <aside class="sidebar" id="sidebar">
              <div class="sidebar-content">
                <div class="palette-title">Question Palette</div>
                <div class="question-palette" id="questionPalette"></div>
                <div class="palette-summary">
                    <div class="summary-item"><span id="summaryAnswered">0</span> Answered</div>
                    <div class="summary-item"><span id="summaryNotAnswered">0</span> Not Answered</div>
                    <div class="summary-item"><span id="summaryMarked">0</span> Marked Review</div>
                    <div class="summary-item"><span id="summaryNotVisited">0</span> Not Visited</div>
                </div>
                <div class="legend">
                    <div class="legend-title">Legend</div>
                    <div class="legend-item"><div class="legend-color answered"></div><span>Answered</span></div>
                    <div class="legend-item"><div class="legend-color not-answered"></div><span>Not Answered</span></div>
                    <div class="legend-item"><div class="legend-color marked"></div><span>Marked</span></div>
                    <div class="legend-item"><div class="legend-color marked-answered"></div><span>Marked & Answered</span></div>
                    <div class="legend-item"><div class="legend-color not-visited"></div><span>Not Visited</span></div>
                </div>
              </div>
            </aside>
        </div>
        <div id="resultScreenWrapper">
            <h2>Test Completed!</h2>
            <p>Here is your score summary:</p>
            <p id="finalScore"></p> <!-- Kept for data storage but hidden -->

            <div class="scorecard-details">
                <table class="scorecard-table">
                    <tbody>
                        <tr>
                            <td><i class="fas fa-check-circle" style="color: #4caf50; margin-right: 8px;"></i>Correct Answers</td>
                            <td class="correct-val"><span id="correctCount">0</span> (<span id="correctMarks">0</span> Marks)</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-times-circle" style="color: #f44336; margin-right: 8px;"></i>Incorrect Answers</td>
                            <td class="incorrect-val"><span id="incorrectCount">0</span> (<span id="incorrectMarks">0</span> Marks)</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-minus-circle" style="color: #ff9800; margin-right: 8px;"></i>Unattempted</td>
                            <td class="unattempted-val"><span id="unattemptedCount">0</span></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Final Score</strong></td>
                            <td class="total-val"><strong><span id="finalScoreAnimated">0</span> / <span id="totalPossibleScore">0</span></strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="result-buttons">
              <button id="retestButton" class="submit-button btn-action"><i class="fas fa-redo"></i> Retest</button>
              <button id="reviewAnswersButton" class="submit-button btn-action"><i class="fas fa-search"></i> Review Answers</button>
            </div>

            <div class="performance-analysis-container">
                <h3>Topic-wise Performance</h3>
                <div class="table-wrapper"><table class="performance-table"><thead><tr><th>Topic</th><th>Correct</th><th>Attempted</th><th>Accuracy</th></tr></thead><tbody id="performanceTableBody"></tbody></table></div>
            </div>
            <div class="chart-container"><canvas id="performanceChart"></canvas></div>
        </div>
        <div id="reviewScreenWrapper">
          <div class="review-header"><h2 class="review-title">Review Your Answers</h2><button id="backToResultsBtn" class="submit-button btn-action"><i class="fas fa-arrow-left"></i> Back to Score</button></div>
          <div id="reviewContainer"></div>
        </div>
       <div id="answerWritingWrapper">
    <h2>Answer Writing Practice</h2>
    <p>
        This section is dedicated to practicing descriptive answers.  
        Answer writing will be based on <strong>the following 5 chapters</strong>:
    </p>
    <ul>
        <li>Chapter 6: Union and its Territory</li>
        <li>Chapter 7: Citizenship</li>
        <li>Chapter 8: Fundamental Rights</li>
        <li>Chapter 9: Directive Principles of State Policy</li>
        <li>Chapter 10: Fundamental Duties</li>
    </ul>

    <!-- 📘 Instructions -->
    <div class="answer-writing-instructions">
        <h3>📘 Instructions for Answer Writing (UPSC Mains)</h3>
        <ol>
            <li><strong>Word Limit:</strong> Stick to the prescribed limit (150 / 250 words).</li>
            <li><strong>Structure:</strong> Follow Introduction → Body → Conclusion.</li>
            <li><strong>Introduction:</strong> Define, contextualize, or give a constitutional reference.</li>
            <li><strong>Body:</strong> Use Articles, examples, case laws, and committee recommendations.</li>
            <li><strong>Conclusion:</strong> End with way forward, constitutional ideals, or relevance to contemporary issues.</li>
            <li><strong>Presentation:</strong> Use headings, subheadings, and short bullet points.</li>
        </ol>
    </div>

    <!-- ✍️ Practice Questions -->
    <div class="answer-writing-questions">
        <h3>✍️ Practice Questions</h3>
        <ol>
            <li>
                <strong>Q1. Union and its Territory</strong><br>
                The reorganization of states in India was driven by linguistic and cultural aspirations. 
                Critically analyze how Article 3 of the Constitution has shaped India’s territorial integrity 
                and challenges in federal relations.  
                <em>(Word limit: 250)</em>
            </li>
            <li>
                <strong>Q2. Fundamental Rights vs. DPSP</strong><br>
                Fundamental Rights and Directive Principles of State Policy (DPSPs) are often described 
                as complementary to each other. Examine this relationship with reference to key Supreme 
                Court judgments.  
                <em>(Word limit: 250)</em>
            </li>
            <li>
                <strong>Q3. Fundamental Duties & Citizenship</strong><br>
                “Fundamental Duties act as a constant reminder to citizens that rights are not absolute, 
                but balanced by responsibilities.” Discuss in the context of present challenges to 
                constitutional morality in India.  
                <em>(Word limit: 150)</em>
            </li>
        </ol>
    </div>
</div>


    </div>
    <div class="fixed-action-area" id="mcqFooter">
        <div class="action-buttons">
            <button class="btn-action" id="btnPrevQuestion"><i class="fas fa-arrow-left"></i><span>Previous</span></button>
            <button class="btn-action" id="btnClearResponse"><i class="fas fa-ban"></i><span>Clear</span></button>
            <button class="btn-action" id="btnMarkReview"><i class="fas fa-flag"></i><span>Mark</span></button>
            <button class="btn-action" id="btnSaveNext"><i class="fas fa-check"></i><span>Save & Next</span></button>
        </div>
    </div>
  </div>
  <div id="passwordModal" class="password-modal">
        <div class="modal-content">
            <span id="closeModal" class="close-modal">×</span>
            <h3>Enter Password to Retest</h3>
            <input type="password" id="passwordRetestInput" placeholder="Enter password...">
            <div id="passwordError"></div>
            <button id="verifyPasswordButton" class="submit-button btn-action">Verify</button>
            <p class="contact-admin-text">Don't have a password? <a id="whatsappLink" href="#" target="_blank">Contact Admin</a></p>
        </div>
  </div>

 <script>
    // ### CONFIGURATION ###
    const CORRECT_USER_ID = "UPSC2025";
    const CORRECT_PASSWORD = "UPSChub@123";
    const RETEST_PASSWORD = "UPSChub";
    const TEST_DURATION_SECONDS = 150 * 60;
    const PER_QUESTION_TIME = 15;
const questions = [
  // ------------------ Parliament – Indian Polity (Laxmikanth Ch.23) ------------------

  {
    "topic": "Parliament - Indian Polity",
    "text": "The Indian Parliament consists of:",
    "options": ["President, Lok Sabha, Rajya Sabha", "President, Prime Minister, Rajya Sabha", "Lok Sabha, Rajya Sabha only", "President, Vice-President, Lok Sabha"],
    "answer": 0,
    "explanation": "Parliament of India consists of the President, Lok Sabha, and Rajya Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which article of the Constitution defines Parliament?",
    "options": ["Article 74", "Article 79", "Article 80", "Article 81"],
    "answer": 1,
    "explanation": "Article 79 states that Parliament consists of the President and two Houses."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Rajya Sabha is also known as:",
    "options": ["House of the People", "Council of States", "Upper Chamber", "Both 2 and 3"],
    "answer": 3,
    "explanation": "Rajya Sabha is the Council of States and also called the Upper House."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The maximum strength of Rajya Sabha is:",
    "options": ["238", "250", "245", "252"],
    "answer": 1,
    "explanation": "Rajya Sabha has a maximum strength of 250 (238 elected + 12 nominated)."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The first Lok Sabha was constituted in:",
    "options": ["1947", "1950", "1952", "1956"],
    "answer": 2,
    "explanation": "The first Lok Sabha was constituted in 1952 after the first general elections."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who decides whether a Bill is a Money Bill?",
    "options": ["Finance Minister", "President", "Speaker of Lok Sabha", "Chairman of Rajya Sabha"],
    "answer": 2,
    "explanation": "The Speaker of Lok Sabha certifies whether a Bill is a Money Bill."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which article provides for the composition of Rajya Sabha?",
    "options": ["Article 80", "Article 81", "Article 82", "Article 83"],
    "answer": 0,
    "explanation": "Article 80 deals with the composition of Rajya Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The minimum age to be a member of Rajya Sabha is:",
    "options": ["25 years", "30 years", "35 years", "21 years"],
    "answer": 1,
    "explanation": "The minimum age for Rajya Sabha membership is 30 years."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The maximum strength of Lok Sabha is:",
    "options": ["545", "552", "560", "530"],
    "answer": 1,
    "explanation": "Lok Sabha can have a maximum of 552 members (530 from states, 20 from UTs, 2 nominated)."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who presides over the joint sitting of Parliament?",
    "options": ["President", "Vice-President", "Speaker of Lok Sabha", "Prime Minister"],
    "answer": 2,
    "explanation": "The Speaker of Lok Sabha presides over joint sittings of Parliament."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The tenure of Rajya Sabha is:",
    "options": ["5 years", "6 years", "Permanent body", "7 years"],
    "answer": 2,
    "explanation": "Rajya Sabha is a permanent body and not subject to dissolution; one-third members retire every two years."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who is the ex-officio Chairman of Rajya Sabha?",
    "options": ["President", "Vice-President", "Prime Minister", "Chief Justice of India"],
    "answer": 1,
    "explanation": "The Vice-President of India is the ex-officio Chairman of Rajya Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "What is the quorum for Lok Sabha meetings?",
    "options": ["1/10th of total membership", "1/5th of total membership", "1/3rd of total membership", "50 members"],
    "answer": 0,
    "explanation": "The quorum for either House of Parliament is 1/10th of the total membership."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Money Bill can be introduced only in:",
    "options": ["Lok Sabha", "Rajya Sabha", "Either House", "Joint Sitting"],
    "answer": 0,
    "explanation": "Money Bill can only be introduced in the Lok Sabha on the recommendation of the President."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Joint sitting of Parliament is called by:",
    "options": ["President", "Prime Minister", "Speaker", "Vice-President"],
    "answer": 0,
    "explanation": "The President summons a joint sitting of both Houses of Parliament."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who can summon each House of Parliament?",
    "options": ["Prime Minister", "President", "Speaker", "Cabinet"],
    "answer": 1,
    "explanation": "The President summons each House of Parliament."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which article deals with the duration of Houses of Parliament?",
    "options": ["Article 83", "Article 84", "Article 85", "Article 86"],
    "answer": 0,
    "explanation": "Article 83 provides for the duration of Houses of Parliament."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The Speaker of Lok Sabha is elected by:",
    "options": ["Members of Lok Sabha", "Members of Rajya Sabha", "President", "Electoral College"],
    "answer": 0,
    "explanation": "The Speaker of Lok Sabha is elected by its members."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Maximum number of nominated members in Rajya Sabha:",
    "options": ["2", "10", "12", "15"],
    "answer": 2,
    "explanation": "Rajya Sabha has 12 nominated members from fields like literature, science, art, and social service."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who decides on the disqualification of MPs on grounds of defection?",
    "options": ["President", "Supreme Court", "Speaker/Chairman", "Election Commission"],
    "answer": 2,
    "explanation": "The Speaker (Lok Sabha) or Chairman (Rajya Sabha) decides disqualification under the Anti-Defection Law."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The first Speaker of Lok Sabha was:",
    "options": ["G.V. Mavalankar", "Hukam Singh", "Bali Ram Bhagat", "P.A. Sangma"],
    "answer": 0,
    "explanation": "G.V. Mavalankar was the first Speaker of Lok Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The minimum age to be elected as a member of Lok Sabha is:",
    "options": ["18 years", "21 years", "25 years", "30 years"],
    "answer": 2,
    "explanation": "The minimum age for Lok Sabha membership is 25 years."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which article deals with the composition of Lok Sabha?",
    "options": ["Article 80", "Article 81", "Article 82", "Article 83"],
    "answer": 1,
    "explanation": "Article 81 deals with the composition of Lok Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The Speaker holds office till:",
    "options": ["5 years", "Dissolution of Lok Sabha", "Resignation", "Both 2 and 3"],
    "answer": 3,
    "explanation": "The Speaker holds office till the dissolution of the House or resignation."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The maximum gap between two sessions of Parliament cannot exceed:",
    "options": ["3 months", "4 months", "6 months", \"9 months\"],
    "answer": 2,
    "explanation": \"The gap between two sessions of Parliament cannot exceed six months.\"
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The maximum period for which Parliament can be prorogued is:",
    "options": ["3 months", "4 months", "6 months", "No maximum limit"],
    "answer": 3,
    "explanation": "There is no maximum limit for prorogation. However, the gap between two sessions cannot exceed 6 months."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which article gives the President power to summon and prorogue Parliament?",
    "options": ["Article 85", "Article 86", "Article 87", "Article 88"],
    "answer": 0,
    "explanation": "Article 85 gives the President power to summon, prorogue, and dissolve the Lok Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who addresses the first session of Parliament after each general election?",
    "options": ["Prime Minister", "President", "Speaker", "Vice-President"],
    "answer": 1,
    "explanation": "The President addresses the first session of Parliament after each general election and the first session each year."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "What is the maximum strength of Lok Sabha representing states?",
    "options": ["500", "530", "545", "552"],
    "answer": 1,
    "explanation": "Out of the maximum 552 members, 530 represent the states."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who presides over Lok Sabha when both Speaker and Deputy Speaker are absent?",
    "options": ["Prime Minister", "President", "Panel of Chairpersons member", "Leader of Opposition"],
    "answer": 2,
    "explanation": "In the absence of both Speaker and Deputy Speaker, one member from the Panel of Chairpersons presides over Lok Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which article deals with the qualifications of MPs?",
    "options": ["Article 83", "Article 84", "Article 85", "Article 86"],
    "answer": 1,
    "explanation": "Article 84 lays down qualifications for membership of Parliament."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The joint sitting of Parliament is not applicable to:",
    "options": ["Ordinary Bills", "Constitutional Amendment Bills", "Money Bills", "Both 2 and 3"],
    "answer": 3,
    "explanation": "Joint sitting is applicable only to Ordinary Bills, not Constitutional Amendment or Money Bills."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "In which year was the Anti-Defection Law added?",
    "options": ["1975", "1982", "1985", "1992"],
    "answer": 2,
    "explanation": "The Anti-Defection Law was added in 1985 through the 52nd Amendment."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The President can dissolve:",
    "options": ["Rajya Sabha only", "Lok Sabha only", "Both Houses", "Neither House"],
    "answer": 1,
    "explanation": "Only Lok Sabha can be dissolved by the President. Rajya Sabha is a permanent body."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which committee recommends the financial allocation for ministries?",
    "options": ["Public Accounts Committee", "Estimates Committee", "Business Advisory Committee", "Committee on Demands for Grants"],
    "answer": 3,
    "explanation": "Committee on Demands for Grants recommends the allocation of financial resources to ministries."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The number of Anglo-Indians that can be nominated to Lok Sabha (before 2020) was:",
    "options": ["2", "5", "10", "12"],
    "answer": 0,
    "explanation": "The President could nominate 2 Anglo-Indians to Lok Sabha, but this provision was removed by the 104th Amendment, 2020."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The minimum number of sessions Parliament must hold in a year is:",
    "options": ["2", "3", "4", "5"],
    "answer": 1,
    "explanation": "By convention, Parliament holds 3 sessions a year – Budget, Monsoon, and Winter."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "What is the Zero Hour in Parliament?",
    "options": ["12 to 1 PM session", "Question Hour", "Midnight session", "Time before lunch"],
    "answer": 0,
    "explanation": "Zero Hour is an Indian innovation; it starts at 12 noon after Question Hour."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who decides the Question Hour schedule?",
    "options": ["President", "Prime Minister", "Speaker", "Parliamentary Affairs Minister"],
    "answer": 2,
    "explanation": "The Speaker of Lok Sabha decides the schedule and rules of Question Hour."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The term 'Budget' is mentioned in which Article of the Constitution?",
    "options": ["Article 110", "Article 111", "Article 112", "Article 113"],
    "answer": 2,
    "explanation": "Article 112 deals with the Annual Financial Statement, also called the Union Budget."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who lays the reports of CAG before Parliament?",
    "options": ["Finance Minister", "Prime Minister", "President", "CAG himself"],
    "answer": 2,
    "explanation": "The President lays the reports of CAG before Parliament."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which of the following is a Parliamentary privilege?",
    "options": ["Freedom of Speech in Parliament", "Exemption from Jury Service", "Right to Punish for Contempt", "All of the above"],
    "answer": 3,
    "explanation": "Parliamentary privileges include freedom of speech, exemption from jury service, and right to punish for contempt."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Adjournment motion is introduced to discuss:",
    "options": ["Ordinary business", "Matters of urgent public importance", "Budget proposals", "Amendments to Constitution"],
    "answer": 1,
    "explanation": "Adjournment motion is used to discuss a matter of urgent public importance in Lok Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which Parliamentary committee examines the report of CAG?",
    "options": ["Public Accounts Committee", "Estimates Committee", "Committee on Privileges", "Business Advisory Committee"],
    "answer": 0,
    "explanation": "The Public Accounts Committee examines the report of the Comptroller and Auditor General (CAG)."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who is considered the 'Guardian of Public Purse'?",
    "options": ["Prime Minister", "Finance Minister", "Parliament", "CAG"],
    "answer": 3,
    "explanation": "The CAG of India is regarded as the 'Guardian of Public Purse'."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which of these committees is exclusively of Lok Sabha?",
    "options": ["Public Accounts Committee", "Estimates Committee", "Committee on Public Undertakings", "All are joint committees"],
    "answer": 1,
    "explanation": "The Estimates Committee has only Lok Sabha members, unlike other joint committees."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who can move a no-confidence motion in Lok Sabha?",
    "options": ["Prime Minister", "Any member of Lok Sabha", "Leader of Opposition", "President"],
    "answer": 1,
    "explanation": "Any member of Lok Sabha can move a no-confidence motion against the Council of Ministers."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The Speaker's salary is charged on:",
    "options": ["Consolidated Fund of India", "Contingency Fund of India", "Public Account of India", "Voted by Parliament"],
    "answer": 0,
    "explanation": "The salaries of Speaker, judges, and CAG are charged on the Consolidated Fund of India."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "When was the Rajya Sabha first constituted?",
    "options": ["1947", "1950", "1952", "1954"],
    "answer": 1,
    "explanation": "Rajya Sabha was first constituted in 1952 but its provision came into effect in 1950."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which House of Parliament is more powerful regarding Money Bills?",
    "options": ["Lok Sabha", "Rajya Sabha", "Equal power", "President"],
    "answer": 0,
    "explanation": "Lok Sabha has overriding powers regarding Money Bills. Rajya Sabha can only recommend changes."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which of the following motions expresses lack of confidence in the government?",
    "options": ["Censure Motion", "No-Confidence Motion", "Privilege Motion", "Calling Attention Motion"],
    "answer": 1,
    "explanation": "A no-confidence motion, if passed, requires the government to resign."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The Speaker of Lok Sabha can be removed by:",
    "options": ["Simple majority of members present and voting", "Absolute majority of the House", "2/3rd majority of total membership", "2/3rd majority of members present"],
    "answer": 1,
    "explanation": "The Speaker can be removed by a resolution passed by an absolute majority of the House."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which type of bill requires prior recommendation of the President before introduction?",
    "options": ["Ordinary Bill", "Constitutional Amendment Bill", "Money Bill", "Private Member’s Bill"],
    "answer": 2,
    "explanation": "Money Bills require prior recommendation of the President."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which Parliamentary Committee scrutinizes appropriation and finance accounts?",
    "options": ["Public Accounts Committee", "Estimates Committee", "Privileges Committee", "Petitions Committee"],
    "answer": 0,
    "explanation": "Public Accounts Committee examines appropriation and finance accounts."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The term of office of the Rajya Sabha Chairman is:",
    "options": ["5 years", "6 years", "Till he remains Vice-President", "At the pleasure of the President"],
    "answer": 2,
    "explanation": "The Vice-President of India is the ex-officio Chairman of Rajya Sabha and holds the position as long as he is Vice-President."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which schedule of the Constitution deals with division of seats among states in Rajya Sabha?",
    "options": ["Second Schedule", "Third Schedule", "Fourth Schedule", "Seventh Schedule"],
    "answer": 2,
    "explanation": "The Fourth Schedule allocates seats in Rajya Sabha to the states and union territories."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The quorum required in each House of Parliament is:",
    "options": ["1/2 of total members", "1/10 of total members", "1/5 of total members", "1/3 of total members"],
    "answer": 1,
    "explanation": "The quorum to constitute a meeting is 1/10 of the total number of members of the House."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which of the following motions needs support of 50 members to be admitted?",
    "options": ["Censure Motion", "No-Confidence Motion", "Adjournment Motion", "Cut Motion"],
    "answer": 1,
    "explanation": "A no-confidence motion can be admitted only if it has support of at least 50 members."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The Budget is presented in Parliament by:",
    "options": ["Prime Minister", "Finance Minister", "President", "Speaker"],
    "answer": 1,
    "explanation": "The Finance Minister presents the Union Budget in Parliament."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which bill cannot be introduced in Rajya Sabha?",
    "options": ["Ordinary Bill", "Money Bill", "Constitutional Amendment Bill", "Private Member’s Bill"],
    "answer": 1,
    "explanation": "Money Bills can only be introduced in Lok Sabha."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The Speaker of Lok Sabha casts a vote only in case of:",
    "options": ["First vote", "Tie", "Money Bill", "No-Confidence Motion"],
    "answer": 1,
    "explanation": "The Speaker exercises a casting vote in case of a tie."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The Rajya Sabha has exclusive power in relation to:",
    "options": ["Impeachment of the President", "Creation of All-India Services", "Removal of Judges", "Money Bills"],
    "answer": 1,
    "explanation": "Rajya Sabha can empower Parliament to create new All-India Services under Article 312."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which of these is not a type of Parliamentary motion?",
    "options": ["Censure Motion", "Privilege Motion", "Closure Motion", "Judicial Motion"],
    "answer": 3,
    "explanation": "Judicial motion is not a recognized type of Parliamentary motion."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which of these motions requires resignation of the Council of Ministers if passed?",
    "options": ["Censure Motion", "No-Confidence Motion", "Adjournment Motion", "Privilege Motion"],
    "answer": 1,
    "explanation": "A no-confidence motion, if passed, leads to resignation of the Council of Ministers."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who presides over the Lok Sabha when the Speaker and Deputy Speaker are absent?",
    "options": ["President", "Prime Minister", "Member of the Panel of Chairpersons", "Attorney General"],
    "answer": 2,
    "explanation": "In absence of Speaker and Deputy Speaker, a member from the Panel of Chairpersons presides."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which of the following committees is not a financial committee?",
    "options": ["Public Accounts Committee", "Estimates Committee", "Committee on Public Undertakings", "Committee on Privileges"],
    "answer": 3,
    "explanation": "The Committee on Privileges is not a financial committee."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who decides on disqualification of MPs under Anti-Defection Law?",
    "options": ["President", "Speaker/Chairman", "Supreme Court", "Election Commission"],
    "answer": 1,
    "explanation": "The decision on disqualification under Anti-Defection Law is made by the Speaker (Lok Sabha) or Chairman (Rajya Sabha)."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "What is the maximum life of a Joint Parliamentary Committee?",
    "options": ["1 year", "2 years", "Till its task is completed", "6 months"],
    "answer": 2,
    "explanation": "A Joint Committee continues until it completes its assigned task."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which article empowers the Parliament to make laws on Union List subjects?",
    "options": ["Article 245", "Article 246", "Article 248", "Article 249"],
    "answer": 1,
    "explanation": "Article 246 gives Parliament exclusive power to make laws on subjects in the Union List."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who is the Leader of the Rajya Sabha?",
    "options": ["Vice-President", "Prime Minister", "Leader nominated by the Prime Minister", "President"],
    "answer": 2,
    "explanation": "The Prime Minister nominates a leader for Rajya Sabha, usually a Cabinet Minister."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which motion is used to reduce the demand for grants to Re.1?",
    "options": ["Token Cut Motion", "Economy Cut Motion", "Disapproval Cut Motion", "Policy Cut Motion"],
    "answer": 3,
    "explanation": "Policy Cut Motion is used to reduce the demand for a grant to Re.1."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Who authenticates a Bill after it is passed by both Houses?",
    "options": ["Prime Minister", "Speaker", "President", "Law Minister"],
    "answer": 2,
    "explanation": "A Bill becomes an Act only after it receives assent from the President."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "Which of these motions is unique to Indian Parliament?",
    "options": ["Adjournment Motion", "Privilege Motion", "Zero Hour", "Closure Motion"],
    "answer": 2,
    "explanation": "Zero Hour is an innovation in the Indian Parliament and is not mentioned in the Constitution."
  },
  {
    "topic": "Parliament - Indian Polity",
    "text": "The 'Rule of Lapse' applies to:",
    "options": ["Money Bills only", "All pending Bills", "Demands for Grants", "Private Member’s Bills"],
    "answer": 2,
    "explanation": "Demands for Grants that are not voted lapse at the end of the financial year."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Which article of the Constitution deals with the annual financial statement (budget)?",
    "options": ["Article 110", "Article 112", "Article 114", "Article 117"],
    "answer": 1,
    "explanation": "Article 112 provides that the President shall cause the annual financial statement to be laid before Parliament."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Money Bill is defined under which article?",
    "options": ["Article 109", "Article 110", "Article 111", "Article 112"],
    "answer": 1,
    "explanation": "Article 110 defines a Money Bill."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Who can introduce a Money Bill in Parliament?",
    "options": ["Any MP", "Only a Minister", "Finance Minister on behalf of the President", "President directly"],
    "answer": 2,
    "explanation": "A Money Bill can only be introduced in Lok Sabha on the recommendation of the President, usually by the Finance Minister."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Vote on Account is granted for a period of usually:",
    "options": ["1 month", "2 months", "3 months", "6 months"],
    "answer": 2,
    "explanation": "Vote on Account is generally granted for two months, but can be longer."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Which of the following is NOT charged expenditure on the Consolidated Fund of India?",
    "options": ["Salaries of Supreme Court judges", "Salary of the Speaker", "Defense expenditure", "Debt charges"],
    "answer": 2,
    "explanation": "Defense expenditure is voted expenditure; salaries of SC judges, Speaker, and debt charges are charged expenditures."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Cut motions are related to:",
    "options": ["Demand for Grants", "Money Bills", "Constitutional Amendments", "Private Member Bills"],
    "answer": 0,
    "explanation": "Cut motions are moved in the Lok Sabha to reduce a demand for grant."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Which cut motion criticizes government policy?",
    "options": ["Policy Cut", "Economy Cut", "Token Cut", "Privilege Cut"],
    "answer": 0,
    "explanation": "Policy Cut motion criticizes the policy underlying a demand."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Which cut motion reduces the amount of demand to Re.1?",
    "options": ["Policy Cut", "Economy Cut", "Token Cut", "Privilege Cut"],
    "answer": 0,
    "explanation": "Policy Cut reduces the demand to Re.1."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Which cut motion reduces a demand by a specified amount?",
    "options": ["Policy Cut", "Economy Cut", "Token Cut", "Privilege Cut"],
    "answer": 1,
    "explanation": "Economy Cut motion reduces a demand by a specific amount."
  },
  {
    "topic": "Parliament - Budget",
    "text": "Which cut motion reduces a demand by Rs.100?",
    "options": ["Policy Cut", "Economy Cut", "Token Cut", "Privilege Cut"],
    "answer": 2,
    "explanation": "Token Cut motion reduces a demand by Rs.100 to draw attention to a grievance."
  },
  {
    "topic": "Parliament - Parliamentary Devices",
    "text": "Adjournment motion requires support of how many members in Lok Sabha?",
    "options": ["10", "25", "50", "100"],
    "answer": 2,
    "explanation": "Adjournment motion requires support of 50 members in Lok Sabha."
  },
  {
    "topic": "Parliament - Parliamentary Devices",
    "text": "Calling attention motion was introduced in India by:",
    "options": ["Lok Sabha", "Rajya Sabha", "Indira Gandhi", "Rajya Sabha Chairman"],
    "answer": 0,
    "explanation": "Calling attention motion was introduced in Lok Sabha in 1954."
  },
  {
    "topic": "Parliament - Parliamentary Devices",
    "text": "Zero Hour starts immediately after:",
    "options": ["Question Hour", "Lunch Break", "Adjournment", "Calling Attention Motion"],
    "answer": 0,
    "explanation": "Zero Hour starts immediately after Question Hour in both Houses."
  },
  {
    "topic": "Parliament - Parliamentary Devices",
    "text": "Which motion expresses lack of confidence in the entire Council of Ministers?",
    "options": ["Adjournment Motion", "Censure Motion", "No-Confidence Motion", "Privilege Motion"],
    "answer": 2,
    "explanation": "No-Confidence Motion is moved against the Council of Ministers as a whole."
  },
  {
    "topic": "Parliament - Parliamentary Devices",
    "text": "Censure Motion differs from No-Confidence Motion in that:",
    "options": ["It need not state reasons", "It is against policies only", "It results in resignation of government", "It is not allowed in Lok Sabha"],
    "answer": 1,
    "explanation": "Censure Motion is moved against specific policies of the government."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which of the following bills requires prior recommendation of the President?",
    "options": ["Ordinary Bill", "Money Bill", "Finance Bill", "Both Money and Finance Bills"],
    "answer": 3,
    "explanation": "Money Bills and Finance Bills require the President’s recommendation before introduction."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which bill can be introduced only in Lok Sabha and not in Rajya Sabha?",
    "options": ["Ordinary Bill", "Money Bill", "Constitution Amendment Bill", "Private Member Bill"],
    "answer": 1,
    "explanation": "Money Bills can be introduced only in the Lok Sabha."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which committee of Parliament is known as the 'watchdog of the treasury'?",
    "options": ["Estimates Committee", "Public Accounts Committee", "Committee on Public Undertakings", "Rules Committee"],
    "answer": 1,
    "explanation": "The Public Accounts Committee is called the watchdog of the treasury."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which committee examines the budget to suggest economies in public expenditure?",
    "options": ["PAC", "Estimates Committee", "Public Undertakings Committee", "Privileges Committee"],
    "answer": 1,
    "explanation": "The Estimates Committee suggests economies and efficiencies in public expenditure."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Who lays the reports of CAG before Parliament?",
    "options": ["President", "Prime Minister", "Finance Minister", "Comptroller and Auditor General"],
    "answer": 0,
    "explanation": "The President lays the CAG reports before Parliament."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "The 'Rule of Lapse' in budget means:",
    "options": ["Unused money lapses back to Consolidated Fund", "Bills lapse at the end of session", "Appropriation Act lapses automatically", "Finance Bill lapses if not passed in time"],
    "answer": 0,
    "explanation": "Rule of Lapse means all unspent money from the Consolidated Fund must return at the end of financial year."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which body recommends the salaries of MPs?",
    "options": ["Finance Commission", "Parliament itself", "President", "Union Cabinet"],
    "answer": 1,
    "explanation": "Parliament decides the salaries and allowances of MPs by law."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which House of Parliament has greater control over the executive?",
    "options": ["Rajya Sabha", "Lok Sabha", "Both equally", "None"],
    "answer": 1,
    "explanation": "Lok Sabha has greater control since the Council of Ministers is collectively responsible only to the Lok Sabha."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which article gives the power to Parliament to make rules for regulating its procedure?",
    "options": ["Article 105", "Article 107", "Article 118", "Article 120"],
    "answer": 2,
    "explanation": "Article 118 empowers each House of Parliament to make rules for regulating its procedure and conduct of business."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Who decides on questions regarding disqualification of MPs on grounds other than defection?",
    "options": ["President", "Election Commission", "Supreme Court", "Speaker"],
    "answer": 0,
    "explanation": "The President decides on disqualification of MPs in consultation with the Election Commission."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which schedule of the Constitution contains the allocation of seats in Rajya Sabha?",
    "options": ["Second Schedule", "Third Schedule", "Fourth Schedule", "Fifth Schedule"],
    "answer": 2,
    "explanation": "The Fourth Schedule deals with the allocation of seats in Rajya Sabha to states and UTs."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Members of Rajya Sabha are elected by which system of representation?",
    "options": ["First Past the Post", "Proportional Representation by STV", "Simple Majority", "Mixed Representation"],
    "answer": 1,
    "explanation": "Members of Rajya Sabha are elected by proportional representation by means of single transferable vote."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Who presides when the Speaker and Deputy Speaker are absent in Lok Sabha?",
    "options": ["President", "Prime Minister", "Any member appointed by the House", "Chairman of Rajya Sabha"],
    "answer": 2,
    "explanation": "In absence of Speaker and Deputy Speaker, a member appointed by the House presides."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which House of Parliament has special powers in matters relating to All-India Services?",
    "options": ["Rajya Sabha", "Lok Sabha", "Both equally", "None"],
    "answer": 0,
    "explanation": "Rajya Sabha has special powers to authorize Parliament to create All-India Services under Article 312."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "In which case did the Supreme Court rule that Parliamentary privileges are subject to fundamental rights?",
    "options": ["Kesavananda Bharati case", "Maneka Gandhi case", "Keshav Singh case", "S.R. Bommai case"],
    "answer": 2,
    "explanation": "In the Keshav Singh case (1965), SC held that Parliamentary privileges are subject to judicial review."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which article allows the President to address both Houses of Parliament?",
    "options": ["Article 85", "Article 86", "Article 87", "Article 88"],
    "answer": 2,
    "explanation": "Article 87 provides for the President's special address to both Houses at the beginning of the first session after each general election and first session of every year."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which parliamentary device is used for short discussion without voting?",
    "options": ["Calling Attention", "Half-an-Hour Discussion", "Motion of Thanks", "Adjournment Motion"],
    "answer": 1,
    "explanation": "Half-an-Hour Discussion allows MPs to seek clarification without voting."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which office conducts elections to the offices of President and Vice President?",
    "options": ["Supreme Court", "Parliament Secretariat", "Election Commission of India", "Union Government"],
    "answer": 2,
    "explanation": "The Election Commission of India conducts elections to the offices of President and Vice President."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which of the following statements is correct about Parliamentary Committees?",
    "options": ["They are mentioned in the Constitution", "They are not mentioned in the Constitution", "They are created by Supreme Court", "They function only during emergency"],
    "answer": 1,
    "explanation": "Parliamentary Committees are not mentioned in the Constitution; they are provided by parliamentary rules/procedures."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "The first Speaker of Lok Sabha was:",
    "options": ["G.V. Mavalankar", "Ananthasayanam Ayyangar", "Bali Ram Bhagat", "M.A. Ayyangar"],
    "answer": 0,
    "explanation": "G.V. Mavalankar was the first Speaker of Lok Sabha."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "What is the minimum age for membership of Rajya Sabha?",
    "options": ["25 years", "30 years", "35 years", "21 years"],
    "answer": 1,
    "explanation": "The minimum age for Rajya Sabha membership is 30 years."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "What is the minimum age for membership of Lok Sabha?",
    "options": ["25 years", "30 years", "21 years", "35 years"],
    "answer": 0,
    "explanation": "The minimum age for Lok Sabha membership is 25 years."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "The quorum to constitute a sitting of either House of Parliament is:",
    "options": ["1/5th of total members", "1/10th of total members", "1/3rd of total members", "1/2 of total members"],
    "answer": 1,
    "explanation": "The quorum is one-tenth of the total number of members of the House."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which House has equal powers with Lok Sabha in the amendment of the Constitution?",
    "options": ["Rajya Sabha", "President", "State Legislatures", "None"],
    "answer": 0,
    "explanation": "Both Rajya Sabha and Lok Sabha have equal powers in the amendment of the Constitution."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "Which House of Parliament is called the 'House of Elders'?",
    "options": ["Lok Sabha", "Rajya Sabha", "Legislative Assembly", "Legislative Council"],
    "answer": 1,
    "explanation": "Rajya Sabha is often referred to as the 'House of Elders'."
  },
  {
    "topic": "Parliament - Miscellaneous",
    "text": "The first woman Speaker of Lok Sabha was:",
    "options": ["Meira Kumar", "Sumitra Mahajan", "Sarojini Naidu", "Pratibha Patil"],
    "answer": 0,
    "explanation": "Meira Kumar was the first woman Speaker of Lok Sabha."
  }
];
    // ### GLOBAL STATE & DOM ELEMENTS ###
    let state = {};
    let timerInterval, onTimerEnd, stopwatchInterval, animationInterval;
    let timeLeft = TEST_DURATION_SECONDS;
    let isTestCompleted = false;
    let performanceChart = null;
    let stopwatchTime = 0;
    let isStopwatchRunning = false;

    const dom = {
      body: document.body,
      loginScreen: document.getElementById('loginScreen'),
      loginBtn: document.getElementById('loginBtn'),
      userIdInput: document.getElementById('userIdInput'),
      passwordLoginInput: document.getElementById('passwordLoginInput'),
      loginError: document.getElementById('loginError'),
      instructionsScreen: document.getElementById('instructionsScreen'),
      startExamBtn: document.getElementById('startExamBtn'),
      offlineStatus: document.getElementById('offlineStatus'),
      agreementCheckbox: document.getElementById('agreementCheckbox'),
      startError: document.getElementById('startError'),
      totalQuestionsEl: document.getElementById('totalQuestionsEl'),
      examUIWrapper: document.getElementById('examUIWrapper'),
      siteHeader: document.getElementById('siteHeader'),
      topbar: document.getElementById('topbar'),
      sidebar: document.getElementById('sidebar'),
      mockTestWrapper: document.getElementById('mockTestWrapper'),
      mcqFooter: document.getElementById('mcqFooter'),
      questionText: document.getElementById('questionText'),
      questionNumber: document.getElementById('questionNumber'),
      questionTimerBar: document.getElementById('questionTimerBar'),
      optionsList: document.getElementById('optionsList'),
      questionPalette: document.getElementById('questionPalette'),
      btnSubmitTest: document.getElementById('btnSubmitTest'),
      btnPrevQuestion: document.getElementById('btnPrevQuestion'),
      btnSaveNext: document.getElementById('btnSaveNext'),
      btnMarkReview: document.getElementById('btnMarkReview'),
      btnClearResponse: document.getElementById('btnClearResponse'),
      timer: document.getElementById('timer'),
      darkModeToggle: document.getElementById('darkModeToggle'),
      toggleLabel: document.getElementById('toggleLabel'),
      sidebarToggle: document.getElementById('btnToggleSidebar'),
      summaryAnswered: document.getElementById('summaryAnswered'),
      summaryNotAnswered: document.getElementById('summaryNotAnswered'),
      summaryMarked: document.getElementById('summaryMarked'),
      summaryNotVisited: document.getElementById('summaryNotVisited'),
      resultScreenWrapper: document.getElementById('resultScreenWrapper'),
      reviewScreenWrapper: document.getElementById('reviewScreenWrapper'),
      performanceTableBody: document.getElementById('performanceTableBody'),
      reviewContainer: document.getElementById('reviewContainer'),
      finalScore: document.getElementById('finalScore'),
      retestButton: document.getElementById('retestButton'),
      reviewAnswersButton: document.getElementById('reviewAnswersButton'),
      backToResultsBtn: document.getElementById('backToResultsBtn'),
      passwordModal: document.getElementById('passwordModal'),
      closeModal: document.getElementById('closeModal'),
      verifyPasswordButton: document.getElementById('verifyPasswordButton'),
      passwordRetestInput: document.getElementById('passwordRetestInput'),
      passwordError: document.getElementById('passwordError'),
      whatsappLink: document.getElementById('whatsappLink'),
      showMockTestTab: document.getElementById('showMockTestTab'),
      showAnswerWritingTab: document.getElementById('showAnswerWritingTab'),
      answerWritingWrapper: document.getElementById('answerWritingWrapper'),
      stopwatchWrapper: document.getElementById('stopwatchWrapper'),
      stopwatchDisplay: document.getElementById('stopwatchDisplay'),
      stopwatchPlayPause: document.getElementById('stopwatchPlayPause'),
      stopwatchReset: document.getElementById('stopwatchReset'),
      correctCount: document.getElementById('correctCount'),
      correctMarks: document.getElementById('correctMarks'),
      incorrectCount: document.getElementById('incorrectCount'),
      incorrectMarks: document.getElementById('incorrectMarks'),
      unattemptedCount: document.getElementById('unattemptedCount'),
      finalScoreAnimated: document.getElementById('finalScoreAnimated'),
      totalPossibleScore: document.getElementById('totalPossibleScore'),
    };

    // ### STAGE 1 & 2: PRE-EXAM LOGIC ###

    function handleLogin() {
        if (dom.userIdInput.value === CORRECT_USER_ID && dom.passwordLoginInput.value === CORRECT_PASSWORD) {
            // ** CORRECTED LOGIC **
            // Add network listeners ONLY after successful login.
            window.addEventListener('online', validateStartConditions);
            window.addEventListener('offline', validateStartConditions);
            // Run once to set the initial state of the instructions screen.
            validateStartConditions(); 

            dom.loginScreen.style.display = 'none';
            dom.instructionsScreen.style.display = 'flex';
        } else {
            dom.loginError.textContent = 'Invalid User ID or Password.';
        }
    }

    function validateStartConditions() {
        const isOffline = !navigator.onLine;
        const isAgreed = dom.agreementCheckbox.checked;
        dom.startExamBtn.disabled = !(isOffline && isAgreed);

        let errorMsg = '';
        if (!isOffline && !isAgreed) errorMsg = 'Please agree to terms and enable Aeroplane Mode.';
        else if (!isOffline) errorMsg = 'Please enable Aeroplane Mode to continue.';
        else if (!isAgreed) errorMsg = 'Please agree to the instructions to start.';
        dom.startError.textContent = errorMsg;

        if (isOffline) {
            dom.offlineStatus.innerHTML = '<i class="fas fa-check-circle"></i> You are offline. Ready to begin.';
            dom.offlineStatus.className = 'status-ready';
        } else {
            dom.offlineStatus.innerHTML = '<i class="fas fa-wifi"></i> Please enable Aeroplane Mode.';
            dom.offlineStatus.className = 'status-waiting';
        }
    }
    
    function startExam() {
        if (dom.startExamBtn.disabled) return;
        dom.instructionsScreen.style.display = 'none';
        dom.examUIWrapper.style.display = 'flex';
        dom.body.classList.add('exam-active');
        updateSidebarPosition();
        window.removeEventListener('online', validateStartConditions);
        window.removeEventListener('offline', validateStartConditions);
        window.addEventListener('online', forceSubmitOnReconnect);
        initTest();
    }

    function forceSubmitOnReconnect() {
        if (!isTestCompleted) {
            alert("Internet connection detected. Submitting the test as per rules.");
            submitTest(true);
        }
    }

    // ### STAGE 3: MAIN TEST LOGIC ###

    function initTest() {
        resetState();
        timeLeft = TEST_DURATION_SECONDS;
        isTestCompleted = false;
        dom.showAnswerWritingTab.classList.add('locked');
        state.visited[0] = true;
        resetStopwatch();
        setView('mockTest');
        loadQuestion(0);
        startTimer();
    }

    function resetState() {
        state = { current: 0, answers: Array(questions.length).fill(null), marked: Array(questions.length).fill(false), visited: Array(questions.length).fill(false) };
    }

    function setView(viewName) {
        dom.mockTestWrapper.style.display = 'none';
        dom.resultScreenWrapper.style.display = 'none';
        dom.reviewScreenWrapper.style.display = 'none';
        dom.answerWritingWrapper.style.display = 'none';
        dom.mcqFooter.style.display = 'none';
        dom.sidebar.style.display = 'none';
        dom.timer.style.display = 'none';
        dom.stopwatchWrapper.style.display = 'none';
        dom.showMockTestTab.classList.remove('active');
        dom.showAnswerWritingTab.classList.remove('active');
        clearInterval(animationInterval);

        if (viewName === 'mockTest') {
            dom.showMockTestTab.classList.add('active');
            dom.timer.style.display = 'block';
            if (isTestCompleted) {
                const breakdown = JSON.parse(localStorage.getItem('scoreBreakdown'));
                const topicStats = JSON.parse(localStorage.getItem('topicStats'));
                showResultScreen(breakdown, topicStats);
            } else {
                dom.mockTestWrapper.style.display = 'flex';
                dom.mcqFooter.style.display = 'block';
                dom.sidebar.style.display = 'flex';
            }
        } else if (viewName === 'answerWriting') {
            if (dom.showAnswerWritingTab.classList.contains('locked')) return;
            dom.showAnswerWritingTab.classList.add('active');
            dom.stopwatchWrapper.style.display = 'flex';
            dom.answerWritingWrapper.style.display = 'flex';
        }
    }

    function loadQuestion(index) {
        state.current = index;
        if (!state.visited[index]) { state.visited[index] = true; }
        startQuestionTimer();
        const q = questions[index];
        dom.questionNumber.textContent = `Question ${index + 1}`;
        dom.questionText.textContent = q.text;
        dom.optionsList.innerHTML = '';
        q.options.forEach((opt, i) => {
            const li = document.createElement('li');
            li.className = 'option';
            if (state.answers[index] === i) li.classList.add('selected');
            li.innerHTML = `<span class="option-radio"></span><span class="option-text">${opt}</span>`;
            li.onclick = () => selectOption(i);
            dom.optionsList.appendChild(li);
        });
        dom.btnSubmitTest.style.display = (state.current === questions.length - 1) ? 'flex' : 'none';
        updatePalette();
        updateNavigationButtons();
    }

    function selectOption(optIndex) {
        state.answers[state.current] = optIndex;
        dom.optionsList.querySelectorAll('.option').forEach((opt, i) => opt.classList.toggle('selected', i === optIndex));
        updatePalette();
    }

    function handleSaveAndNext() {
      if (isTestCompleted) return;
      if (state.current < questions.length - 1) {
          loadQuestion(state.current + 1);
      } else {
          submitTest(true);
      }
    }

    function handleMarkAndNext() {
      if (isTestCompleted) return;
      state.marked[state.current] = true;
      handleSaveAndNext();
    }
    
    function handleClearResponse() {
        state.answers[state.current] = null;
        dom.optionsList.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
        updatePalette();
    }

    function submitTest(isForced = false) {
        if (isTestCompleted) return;
        if (!isForced) {
             if (!confirm('Are you sure you want to submit the test?')) return;
        }

        stopTimer();
        isTestCompleted = true;
        window.removeEventListener('online', forceSubmitOnReconnect);
        dom.showAnswerWritingTab.classList.remove('locked');
        
        const scoreBreakdown = calculateScoreBreakdown();
        const topicStats = calculateTopicStats();

        localStorage.setItem('testTaken', 'true');
        localStorage.setItem('lastAnswers', JSON.stringify(state.answers));
        localStorage.setItem('scoreBreakdown', JSON.stringify(scoreBreakdown));
        localStorage.setItem('topicStats', JSON.stringify(topicStats));

        showResultScreen(scoreBreakdown, topicStats);
    }
    
    function calculateScoreBreakdown() {
        let correctCount = 0, incorrectCount = 0;
        state.answers.forEach((ans, i) => {
            if (ans !== null) {
                if (ans === questions[i].answer) correctCount++;
                else incorrectCount++;
            }
        });
        const unattemptedCount = questions.length - correctCount - incorrectCount;
        const totalScore = correctCount - incorrectCount;

        return {
            correctCount,
            incorrectCount,
            unattemptedCount,
            totalScore,
            totalQuestions: questions.length,
            correctMarks: correctCount * 1,
            incorrectMarks: incorrectCount * -1,
        };
    }

    function updatePalette() {
        dom.questionPalette.innerHTML = '';
        let answered = 0, notAnswered = 0, marked = 0, notVisited = 0;
        questions.forEach((_, i) => {
            const btn = document.createElement('div');
            btn.className = 'question-number';
            const isAnswered = state.answers[i] !== null;
            const isMarked = state.marked[i];
            if(isAnswered && isMarked) btn.classList.add('marked-answered');
            else if(isAnswered) btn.classList.add('answered');
            else if(isMarked) btn.classList.add('marked');
            else if(state.visited[i]) btn.classList.add('not-answered');
            else btn.classList.add('not-visited');
            if (i === state.current) btn.classList.add('current');
            if (isAnswered) answered++;
            if (isMarked) marked++;
            if (!state.visited[i]) notVisited++;
            btn.textContent = i + 1;
            btn.onclick = () => { if (!isTestCompleted) loadQuestion(i); };
            dom.questionPalette.appendChild(btn);
        });
        notAnswered = state.visited.filter((v, i) => v && state.answers[i] === null && !state.marked[i]).length;
        dom.summaryAnswered.textContent = answered;
        dom.summaryMarked.textContent = marked;
        dom.summaryNotAnswered.textContent = notAnswered;
        dom.summaryNotVisited.textContent = notVisited;
    }

    function updateNavigationButtons() {
        dom.btnPrevQuestion.style.display = state.current === 0 ? 'none' : 'flex';
        dom.btnSaveNext.querySelector('span').textContent = (state.current === questions.length - 1) ? "Save & Finish" : "Save & Next";
    }

    function formatTime(totalSeconds) {
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
          if (timeLeft <= 0) {
              clearInterval(timerInterval);
              alert("Time's up! The test will be submitted automatically.");
              submitTest(true);
              return;
          }
          timeLeft--;
          dom.timer.textContent = formatTime(timeLeft);
      }, 1000);
    }
    
    function startQuestionTimer() {
        if (onTimerEnd) dom.questionTimerBar.removeEventListener('transitionend', onTimerEnd);
        onTimerEnd = () => handleSaveAndNext();
        dom.questionTimerBar.style.transition = 'none';
        dom.questionTimerBar.style.width = '100%';
        dom.questionTimerBar.offsetHeight;
        dom.questionTimerBar.style.transition = `width ${PER_QUESTION_TIME}s linear`;
        dom.questionTimerBar.style.width = '0%';
        dom.questionTimerBar.addEventListener('transitionend', onTimerEnd, { once: true });
    }

    function stopTimer() {
        clearInterval(timerInterval);
        if(onTimerEnd) dom.questionTimerBar.removeEventListener('transitionend', onTimerEnd);
    }
    
    function toggleStopwatch() {
        const icon = dom.stopwatchPlayPause.querySelector('i');
        if (isStopwatchRunning) {
            clearInterval(stopwatchInterval);
            icon.classList.replace('fa-pause', 'fa-play');
        } else {
            stopwatchInterval = setInterval(() => {
                stopwatchTime++;
                dom.stopwatchDisplay.textContent = formatTime(stopwatchTime);
            }, 1000);
            icon.classList.replace('fa-play', 'fa-pause');
        }
        isStopwatchRunning = !isStopwatchRunning;
    }

    function resetStopwatch() {
        clearInterval(stopwatchInterval);
        isStopwatchRunning = false;
        stopwatchTime = 0;
        dom.stopwatchDisplay.textContent = formatTime(0);
        const icon = dom.stopwatchPlayPause.querySelector('i');
        if(icon) {
           icon.classList.replace('fa-pause', 'fa-play');
        }
    }

    function toggleDarkMode(isDark) {
        dom.body.classList.toggle('dark', isDark);
        dom.toggleLabel.textContent = isDark ? 'Light' : 'Dark';
        if (isTestCompleted && performanceChart) {
            const topicStats = JSON.parse(localStorage.getItem('topicStats'));
            renderPerformanceChart(topicStats);
        }
    }
    
    function updateSidebarPosition() {
        const headerHeight = dom.siteHeader.offsetHeight;
        const topbarHeight = dom.topbar.offsetHeight;
        const totalHeaderHeight = headerHeight + topbarHeight;
        dom.sidebar.style.top = `${totalHeaderHeight}px`;
        dom.sidebar.style.height = `calc(100% - ${totalHeaderHeight}px)`;
    }

    // ### STAGE 4: RESULT & REVIEW FUNCTIONS ###
    function showResultScreen(breakdown, topicStats) {
        dom.mockTestWrapper.style.display = 'none';
        dom.reviewScreenWrapper.style.display = 'none';
        dom.mcqFooter.style.display = 'none';
        dom.sidebar.style.display = 'none';
        dom.btnSubmitTest.style.display = 'none';
        dom.resultScreenWrapper.style.display = 'flex';
        
        if (breakdown) {
             dom.totalPossibleScore.textContent = breakdown.totalQuestions;
             animateScorecard(breakdown);
        }

        populatePerformanceTable(topicStats);
        setTimeout(() => renderPerformanceChart(topicStats), 100);
    }
    
    function animateScorecard(data) {
        let current = { correctCount: 0, incorrectCount: 0, unattemptedCount: 0, correctMarks: 0, incorrectMarks: 0, totalScore: 0 };
        const animationSpeed = 20;
        const duration = 1200;
        const steps = duration / animationSpeed;
        
        const stepValues = {};
        for (const key in current) {
            stepValues[key] = data[key] / steps;
        }
        
        clearInterval(animationInterval);
        animationInterval = setInterval(() => {
            let finished = true;
            for (const key in current) {
                if (stepValues[key] > 0) { // Positive values
                    if (current[key] < data[key]) {
                        current[key] += stepValues[key];
                        finished = false;
                    } else {
                        current[key] = data[key];
                    }
                } else { // Negative or zero values
                     if (current[key] > data[key]) {
                        current[key] += stepValues[key]; 
                        finished = false;
                    } else {
                        current[key] = data[key];
                    }
                }
            }

            dom.correctCount.textContent = Math.round(current.correctCount);
            dom.correctMarks.textContent = `+${Math.round(current.correctMarks)}`;
            dom.incorrectCount.textContent = Math.round(current.incorrectCount);
            dom.incorrectMarks.textContent = Math.round(current.incorrectMarks);
            dom.unattemptedCount.textContent = Math.round(current.unattemptedCount);
            dom.finalScoreAnimated.textContent = Math.round(current.totalScore);

            if(finished) clearInterval(animationInterval);
        }, animationSpeed);
    }

    function calculateTopicStats() {
      const topicStats = {};
      questions.forEach((q, i) => {
        if (!topicStats[q.topic]) { topicStats[q.topic] = { correct: 0, attempted: 0 }; }
        if (state.answers[i] !== null) {
          topicStats[q.topic].attempted++;
          if (state.answers[i] === q.answer) { topicStats[q.topic].correct++; }
        }
      });
      return topicStats;
    }

    function populatePerformanceTable(topicStats) {
        dom.performanceTableBody.innerHTML = '';
        if (!topicStats) return;
        Object.keys(topicStats).forEach(topicName => {
            const stats = topicStats[topicName];
            const accuracy = stats.attempted > 0 ? Math.round((stats.correct / stats.attempted) * 100) : 0;
            const barColor = accuracy > 75 ? '#4caf50' : accuracy >= 40 ? '#ff9800' : '#f44336';
            const row = `
                <tr>
                    <td>${topicName}</td>
                    <td>${stats.correct}</td>
                    <td>${stats.attempted}</td>
                    <td>
                        <div class="accuracy-bar-container">
                            <div class="accuracy-bar" style="width: ${accuracy}%; background-color: ${barColor};"></div>
                            <span class="accuracy-text">${accuracy}%</span>
                        </div>
                    </td>
                </tr>`;
            dom.performanceTableBody.innerHTML += row;
        });
    }
    
    function renderPerformanceChart(topicStats) {
      if (performanceChart) performanceChart.destroy();
      if (!topicStats) return;
      
      const isDark = dom.body.classList.contains('dark');
      const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      const textColor = isDark ? 'rgba(255, 255, 255, 0.7)' : '#666';

      const labels = Object.keys(topicStats);
      const marksData = labels.map(label => topicStats[label].correct);
      const accuracyData = labels.map(label => {
        const stats = topicStats[label];
        return stats.attempted > 0 ? Math.round((stats.correct / stats.attempted) * 100) : 0;
      });

      const ctx = document.getElementById('performanceChart').getContext('2d');
      performanceChart = new Chart(ctx, {
          type: 'bar', data: { labels: labels, datasets: [{ label: 'Correct Answers (Marks)', data: marksData, backgroundColor: '#3f51b5', yAxisID: 'y' }, { label: 'Accuracy (%)', data: accuracyData, type: 'line', borderColor: '#4caf50', tension: 0.1, yAxisID: 'y1' }] },
          options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, scales: { x: { ticks: { color: textColor }, grid: { color: gridColor } }, y: { type: 'linear', position: 'left', title: { display: true, text: 'Correct Answers', color: textColor }, ticks: { color: textColor, precision: 0 }, grid: { color: gridColor }, beginAtZero: true }, y1: { type: 'linear', position: 'right', min: 0, max: 100, title: { display: true, text: 'Accuracy (%)', color: textColor }, ticks: { color: textColor }, grid: { drawOnChartArea: false } } }, plugins: { legend: { labels: { color: textColor } } } }
      });
    }

    function showReviewScreen() {
      dom.resultScreenWrapper.style.display = 'none';
      dom.reviewScreenWrapper.style.display = 'flex';
      populateReviewScreen();
    }

    function populateReviewScreen() {
        dom.reviewContainer.innerHTML = '';
        const userAnswers = JSON.parse(localStorage.getItem('lastAnswers'));
        if (!userAnswers) return;
        questions.forEach((q, index) => {
            const userAnswer = userAnswers[index];
            const correctAnswer = q.answer;
            const isCorrect = userAnswer === correctAnswer;
            
            let optionsHTML = '';
            q.options.forEach((opt, optIndex) => {
                let classes = 'review-option';
                let icon = '<i class="far fa-circle"></i>';
                if (optIndex === correctAnswer) { classes += ' review-correct'; icon = '<i class="fas fa-check-circle"></i>'; }
                if (optIndex === userAnswer && !isCorrect) { classes += ' review-incorrect'; icon = '<i class="fas fa-times-circle"></i>'; }
                optionsHTML += `<li class="${classes}">${icon}<span>${opt}</span></li>`;
            });

            let statusHTML = '';
            if (userAnswer === null) { statusHTML = '<div class="review-status unanswered">Status: Unanswered</div>'; } 
            else if (isCorrect) { statusHTML = '<div class="review-status correct">Status: Correct</div>'; } 
            else { statusHTML = '<div class="review-status incorrect">Status: Incorrect</div>'; }

            const explanationHTML = `<div class="review-explanation"><strong>Explanation:</strong> ${q.explanation}</div>`;

            const questionDiv = document.createElement('div');
            questionDiv.className = 'review-question';
            questionDiv.innerHTML = `
                <h4>Q${index + 1}: ${q.text}</h4>
                <ul class="review-option-list">${optionsHTML}</ul>
                ${statusHTML}
                ${explanationHTML}
            `;
            dom.reviewContainer.appendChild(questionDiv);
        });
    }

    // ** CORRECTED RETEST FUNCTION **
    function handleRetest() {
        // The user MUST be offline to retest. If they are online, show an error.
        if (navigator.onLine) {
            dom.passwordError.textContent = 'Please enable Aeroplane Mode to retest.';
            return;
        }
      
        // If offline, proceed with the password check.
        if (dom.passwordRetestInput.value === RETEST_PASSWORD) {
            localStorage.clear();
            location.reload(); 
        } else {
            dom.passwordError.textContent = 'Incorrect password.';
        }
    }

    // ### MASTER EVENT LISTENERS SETUP ###
    document.addEventListener('DOMContentLoaded', () => {
        const storedTheme = localStorage.getItem('theme');
        if (storedTheme === 'dark') {
            dom.darkModeToggle.checked = true;
            toggleDarkMode(true);
        }
        
        if (localStorage.getItem('testTaken') === 'true') {
            // This part is for users who have already completed the test and are returning to the page.
            isTestCompleted = true;
            dom.showAnswerWritingTab.classList.remove('locked');
            dom.loginScreen.style.display = 'none';
            dom.examUIWrapper.style.display = 'flex';
            dom.body.classList.add('exam-active');
            updateSidebarPosition();
            const breakdown = JSON.parse(localStorage.getItem('scoreBreakdown'));
            const topicStats = JSON.parse(localStorage.getItem('topicStats'));
            showResultScreen(breakdown, topicStats);
        } else {
            // This is for a fresh start or after a retest.
            // NO network listeners are added here. The login page will just display.
        }
        
        const phone = "918658567727";
        const message = "I need the password for the mock test.";
        dom.whatsappLink.href = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(message)}`;
        
        dom.loginBtn.addEventListener('click', handleLogin);
        dom.startExamBtn.addEventListener('click', startExam);
        dom.agreementCheckbox.addEventListener('change', validateStartConditions);

        dom.btnSaveNext.addEventListener('click', handleSaveAndNext);
        dom.btnPrevQuestion.addEventListener('click', () => { if(state.current > 0 && !isTestCompleted) loadQuestion(state.current - 1); });
        dom.btnMarkReview.addEventListener('click', handleMarkAndNext);
        dom.btnClearResponse.addEventListener('click', handleClearResponse);
        dom.btnSubmitTest.addEventListener('click', () => submitTest(false));
        dom.sidebarToggle.addEventListener('click', () => dom.body.classList.toggle('sidebar-open'));
        dom.darkModeToggle.addEventListener('change', (e) => {
            toggleDarkMode(e.target.checked);
            localStorage.setItem('theme', e.target.checked ? 'dark' : 'light');
        });
        dom.retestButton.addEventListener('click', () => { dom.passwordModal.style.display = 'flex'; });
        dom.reviewAnswersButton.addEventListener('click', showReviewScreen);
        dom.backToResultsBtn.addEventListener('click', () => {
             const breakdown = JSON.parse(localStorage.getItem('scoreBreakdown'));
             const topicStats = JSON.parse(localStorage.getItem('topicStats'));
             showResultScreen(breakdown, topicStats);
        });
        dom.closeModal.addEventListener('click', () => { dom.passwordModal.style.display = 'none'; });
        dom.verifyPasswordButton.addEventListener('click', handleRetest);
        dom.stopwatchPlayPause.addEventListener('click', toggleStopwatch);
        dom.stopwatchReset.addEventListener('click', resetStopwatch);
        dom.showMockTestTab.addEventListener('click', () => setView('mockTest'));
        dom.showAnswerWritingTab.addEventListener('click', () => setView('answerWriting'));

        window.addEventListener('resize', updateSidebarPosition);
    });
  </script>
</body>
</html>
