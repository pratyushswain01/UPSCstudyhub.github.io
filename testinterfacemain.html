<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UPSChub - Mock Test & Answer Writing</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
        height: 100%;
        overflow: hidden; /* Prevent bouncing on mobile */
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f0f0f5;
      color: #333;
      transition: background-color 0.3s ease, color 0.3s ease;
      position: relative;
    }
    
    /* Full-Page Watermark */
    body::after {
        content: "UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \AUPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A UPSChub UPSChub UPSChub UPSChub UPSChub UPSChub \A ";
        position: fixed;
        top: -75%;
        left: -230%;
        width: 530%;
        height: 250%;
        font-size: 4vw;
        font-weight: 600;
        color: rgba(0, 0, 0, 0.05);
        text-align: center;
        line-height: 2.5; 
        transform: rotate(-30deg);
        z-index: 2;
        pointer-events: none;
        white-space: pre;
    }

    .dark {
      background: #1e1e2f;
      color: #eee;
    }
    
    .dark body::after {
        color: rgba(255, 255, 255, 0.05);
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100%; 
      position: relative;
    }

    /* Site Header Styles */
    .site-header {
      background: #ffffff;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      border-bottom: 1px solid #e0e0e0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      z-index: 101;
    }
    .site-logo {
      height: 40px;
      width: auto;
    }
    .site-branding .site-title {
      font-size: 1.4em;
      font-weight: 700;
      color: #3f51b5;
      line-height: 1.1;
    }
    .site-branding .site-tagline {
      font-size: 0.8em;
      color: #666;
      margin: 0;
    }
    
    /* Topbar Styles */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 20px;
      background: #3f51b5;
      color: white;
      gap: 10px;
      z-index: 100;
      position: relative;
    }
    .topbar-left-group { display: flex; align-items: center; gap: 15px; }
    .topbar-right-group { display: flex; align-items: center; gap: 15px; }
    .navigation-tabs { display: flex; gap: 5px; background: rgba(0,0,0,0.15); border-radius: 6px; padding: 3px; position: absolute; left: 50%; transform: translateX(-50%); }
    .nav-tab { background: transparent; border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-weight: 500; transition: all 0.3s; font-size: 0.85em; }
    .nav-tab:hover:not(.locked) { background: rgba(255,255,255,0.2); }
    .nav-tab.active { background: white; color: #3f51b5; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .nav-tab.locked { cursor: not-allowed; opacity: 0.6; position: relative; pointer-events: none; }
    .nav-tab.locked::after { content: '\f023'; font-family: "Font Awesome 6 Free"; font-weight: 900; margin-left: 8px; font-size: 0.9em; }
    
    .timer { font-size: 0.95em; font-weight: bold; white-space: nowrap; background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px; }
    
    /* Stopwatch Styles */
    #stopwatchWrapper { display: none; align-items: center; gap: 10px; }
    #stopwatchDisplay { font-size: 0.95em; font-weight: bold; white-space: nowrap; background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px; }
    .stopwatch-controls button { background: transparent; border: 1px solid rgba(255,255,255,0.3); color: white; cursor: pointer; font-size: 0.8em; padding: 5px; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; margin-left: 5px; }
    .stopwatch-controls button:hover { background-color: rgba(255,255,255,0.2); }

    .dark-mode-toggle { display: flex; align-items: center; gap: 8px; }
    .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .toggle-slider { background-color: #4caf50; }
    input:checked + .toggle-slider:before { transform: translateX(24px); }
    .toggle-label { font-size: 0.9em; white-space: nowrap; }
    
    .topbar #btnSubmitTest {
        background: #f44336; color: white;
        border: none; border-radius: 6px; font-weight: 500; cursor: pointer;
        transition: all 0.2s; display: flex; align-items: center;
        justify-content: center; gap: 6px; font-size: 0.85em;
        padding: 8px 15px;
    }
     .topbar #btnSubmitTest:hover { opacity: 0.85; }
    
    /* Main Content */
    .main-content { flex: 1; display: flex; overflow: hidden; position: relative; }
    .question-area { width: 100%; padding: 20px; overflow-y: auto; padding-bottom: 100px; transition: padding-right 0.3s ease, filter 0.3s ease; position: relative; z-index: 2; }
    .sidebar-open .question-area { filter: blur(4px); pointer-events: none; }
    
    .question-header { font-size: 1.2em; margin-bottom: 15px; font-weight: 600; }
    
    /* Per-Question Timer Bar Styles */
    .question-timer-bar-container {
      width: 100%;
      height: 8px;
      background-color: #e0e0e0;
      border-radius: 4px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    .question-timer-bar {
      height: 100%;
      width: 100%; /* Start at 100% for depletion effect */
      background-color: #3f51b5;
      border-radius: 4px;
      /* The transition is now set dynamically in JS */
    }
    .dark .question-timer-bar-container { background-color: #3d3d4a; }
    .dark .question-timer-bar { background-color: #8ab4f8; }

    .question-content { margin-bottom: 20px; line-height: 1.6; font-size: 1em; }
    .options-list { list-style: none; display: grid; grid-template-columns: 1fr; gap: 10px; padding: 0; }
    .option { padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.2s; background: white; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-size: 0.95em; position: relative; z-index: 2; }
    .option:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .option.selected { background: #4caf50; color: white; border-color: #4caf50; box-shadow: 0 2px 5px rgba(76,175,80,0.3); }
    .option-radio { margin-right: 12px; min-width: 18px; height: 18px; border: 2px solid #ccc; border-radius: 50%; display: inline-block; position: relative; }
    .option.selected .option-radio { border-color: white; background: white; box-shadow: inset 0 0 0 4px #4caf50; }
    
    /* Sidebar */
    .sidebar { position: fixed; top: 111px; right: -300px; width: 300px; height: calc(100% - 111px); background: #f8f9fa; border-left: 1px solid #ccc; display: flex; flex-direction: column; transition: right 0.3s ease-in-out; z-index: 200; box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
    .sidebar-open .sidebar { right: 0; }
    .sidebar-content { padding: 15px; overflow-y: auto; flex-grow: 1;}
    .palette-title { font-weight: 600; margin-bottom: 10px; color: #3f51b5; font-size: 1.1em; text-align: center; }
    .question-palette { display: grid; grid-template-columns: repeat(auto-fill, minmax(35px, 1fr)); gap: 8px; margin-bottom: 20px; }
    .question-number { width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid transparent; cursor: pointer; font-weight: 500; transition: all 0.2s; font-size: 13px; margin: 0 auto; }
    .question-number:hover { transform: scale(1.1); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    
    /* Palette Status Colors */
    .answered { background: #4caf50; color: white; border: 1px solid #388e3c;}
    .not-answered { background: #f44336; color: white; border: 1px solid #d32f2f;}
    .marked { background: #ff9800; color: white; border: 1px solid #f57c00;}
    .marked-answered { background: linear-gradient(135deg, #4caf50 50%, #ff9800 50%); color: white; border: 1px solid #f57c00; }
    .not-visited { background: #e9ecef; color: #333; border: 1px solid #ddd;}
    .current { border: 2px solid #3f51b5; transform: scale(1.1); }
    
    .palette-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; padding: 12px; background: #e0e0e0; border-radius: 6px; font-size: 0.8em; }
    .summary-item { display: flex; align-items: center; gap: 8px; color: #333; }
    .summary-item span { font-weight: 700; background-color: #fff; border-radius: 50%; min-width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center; text-align: center; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    
    .legend { margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;}
    .legend-title { font-weight: 600; margin-bottom: 12px; color: #3f51b5; font-size: 1em; }
    .legend-item { display: flex; align-items: center; margin-bottom: 8px; font-size: 0.85em; padding: 6px 8px; border-radius: 4px; }
    .legend-color { width: 16px; height: 16px; border-radius: 3px; margin-right: 10px; flex-shrink: 0; }
    .legend-answered { background: #4caf50; }
    .legend-not-answered { background: #f44336; }
    .legend-marked { background: #ff9800; }
    .legend-marked-answered { background: linear-gradient(135deg, #4caf50 50%, #ff9800 50%); }
    .legend-not-visited { background: #e9ecef; border: 1px solid #ccc; }
    
    /* Sidebar Toggle */
    .sidebar-toggle { position: fixed; top: 120px; right: 15px; z-index: 300; background: #3f51b5; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.3); color: white; font-size: 1.1em; transition: all 0.3s ease; }
    .sidebar-open .sidebar-toggle { right: 315px; transform: rotate(180deg); }

    /* Fixed Action Area */
    .fixed-action-area { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #ccc; padding: 10px 15px; z-index: 100; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
    .action-buttons { display: flex; justify-content: center; align-items: center; gap: 8px; }
    .btn-action { padding: 8px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.85em; flex-grow: 1; flex-basis: 0; }
    .btn-action:hover { opacity: 0.85; }
    #btnPrevQuestion { background: #6c757d; color: white; }
    #btnSaveNext { background: #4caf50; color: white; }
    #btnMarkReview { background: #ff9800; color: white; }
    #btnClearResponse { background: #f44336; color: white; }
    .submit-button.btn-action { background: #3f51b5; color: white; padding: 10px 25px; flex-grow: 0; /* Override for modal buttons */ } 
    
    /* Result & Review Screens */
    #resultScreenWrapper { display: none; text-align: center; padding: 20px; flex-direction: column; align-items: center; justify-content: flex-start; flex: 1; overflow-y: auto; z-index: 2; position: relative;}
    #resultScreenWrapper h2 { font-size: 2.5em; color: #3f51b5; margin-bottom: 5px; }
    #resultScreenWrapper p { font-size: 1.2em; margin-bottom: 20px; }
    #finalScore { font-weight: 700; font-size: 2.2em; color: #4caf50; letter-spacing: 1px; }
    .result-buttons { display: flex; gap: 15px; margin-top: 30px; margin-bottom: 30px; }
    
    /* Performance Analysis Table & Chart Styles */
    .performance-analysis-container { width: 100%; max-width: 800px; margin: 30px auto; background: #ffffff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .chart-container { width: 100%; max-width: 800px; margin: 30px auto; background: #ffffff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .performance-analysis-container h3 { text-align: center; margin-bottom: 20px; font-size: 1.5em; color: #3f51b5; }
    .table-wrapper { overflow-x: auto; }
    .performance-table { width: 100%; border-collapse: collapse; }
    .performance-table th, .performance-table td { padding: 14px 10px; text-align: center; border-bottom: 1px solid #e0e0e0; font-size: 0.95em; white-space: nowrap; }
    .performance-table th { background-color: #f8f9fa; font-weight: 600; color: #444; }
    .performance-table td:first-child { text-align: left; font-weight: 500; width: 40%; white-space: normal; }
    .accuracy-bar-container { background-color: #e9ecef; border-radius: 10px; position: relative; height: 22px; overflow: hidden; min-width: 100px; }
    .accuracy-bar { height: 100%; border-radius: 10px; transition: width 0.8s ease-in-out; }
    .accuracy-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 600; font-size: 0.9em; color: #333; text-shadow: 0 0 2px rgba(255,255,255,0.7); }

    #performanceChart { width: 100% !important; height: 350px !important; }
    
    /* Review Screen Specific Styles */
    #reviewScreenWrapper { display: none; width: 100%; flex-direction: column; z-index: 2; position: relative;}
    .review-header { padding: 15px 20px; background: #fff; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; }
    #reviewContainer { padding: 20px; overflow-y: auto; flex-grow: 1; background-color: #f0f0f5; }
    .review-question { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .review-option-list { list-style: none; padding: 0; margin-top: 15px; }
    .review-option { padding: 10px 15px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #e0e0e0; display: flex; align-items: center; gap: 12px; }
    .review-option i { min-width: 1.2em; text-align: center; }
    .review-option.review-correct { background-color: #e8f5e9; border-color: #a5d6a7; color: #1b5e20; font-weight: 500; }
    .review-option.review-incorrect { background-color: #ffebee; border-color: #ef9a9a; color: #b71c1c; }
    .review-status { margin-top: 15px; padding: 8px 12px; border-radius: 6px; font-weight: 500; text-align: center; border: 1px solid transparent; }
    .review-status.correct { background-color: #e8f5e9; border-color: #a5d6a7; color: #1b5e20; }
    .review-status.incorrect { background-color: #ffebee; border-color: #ef9a9a; color: #c62828; }
    .review-status.unanswered { background-color: #fff3e0; border-color: #ffcc80; color: #e65100; }
    
    /* Password Modal */
    .password-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center;}
    .modal-content { background-color: #fefefe; padding: 25px 35px; border: 1px solid #888; width: 90%; max-width: 420px; border-radius: 12px; text-align: center; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .close-modal { position: absolute; top: 10px; right: 20px; font-size: 1.8em; color: #aaa; cursor: pointer; transition: color 0.2s; }
    .close-modal:hover { color: #333; }
    #passwordInput { width: 100%; padding: 10px; margin: 15px 0; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
    #passwordError { color: #f44336; font-size: 0.9em; height: 1.2em; margin-bottom: 10px;}
    .contact-admin-text { margin-top: 20px; font-size: 0.9em; color: #666; }
    .contact-admin-text a { color: #3f51b5; text-decoration: none; font-weight: 500; }
    .contact-admin-text a:hover { text-decoration: underline; }

    /* Answer Writing Placeholder */
    #answerWritingWrapper { display: none; flex: 1; align-items: center; justify-content: center; text-align: center; padding: 40px 20px; z-index: 2; position: relative;}
    #answerWritingWrapper h2 { color: #3f51b5; font-size: 1.8em; margin-bottom: 10px; }
    #answerWritingWrapper p { color: #555; font-size: 1.1em; }

    /* Dark Mode Overrides */
    .dark .site-header { background: #2a2a3a; border-bottom-color: #3a3a4a; }
    .dark .site-branding .site-title { color: #8ab4f8; }
    .dark .site-branding .site-tagline { color: #aaa; }
    .dark .option { background: #2c2c3c; border-color: #444; color: #eee; }
    .dark .option:hover { background: #3d3d4a; }
    .dark .option.selected { background: #1b5e20; color: #c8e6c9; border-color: #81c784; }
    .dark .option.selected .option-radio { border-color: #c8e6c9; background: #c8e6c9; box-shadow: inset 0 0 0 4px #1b5e20; }
    .dark .option-radio { border-color: #555; }
    .dark .fixed-action-area { background: #1e1e2f; border-top-color: #444;}
    .dark .sidebar { background: #2a2a3a; border-left: 1px solid #444;}
    .dark .not-visited { background: #3d3d4a; color: #eee; border: 1px solid #555; }
    .dark .palette-summary { background: #1e1e2f; border: 1px solid #444;}
    .dark .summary-item { color: #ccc; }
    .dark .summary-item span { background-color: #3d3d4a; color: #eee; }
    .dark .legend, .dark .fixed-action-area { border-top-color: #444; }
    .dark .legend-item { background: rgba(255,255,255,0.05); }
    .dark .palette-title, .dark .legend-title { color: #8ab4f8; }
    .dark #resultScreenWrapper h2, .dark .performance-analysis-container h3, .dark .review-title, .dark #answerWritingWrapper h2 { color: #8ab4f8; }
    .dark #answerWritingWrapper p { color: #aaa; }
    .dark #finalScore { color: #81c784; }
    .dark .performance-analysis-container, .dark .chart-container { background: #2a2a3a; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    .dark .performance-table th { background-color: #1e1e2f; color: #ccc; }
    .dark .performance-table td { border-bottom: 1px solid #444; }
    .dark .accuracy-bar-container { background-color: #3d3d4a; }
    .dark .accuracy-text { color: #fff; text-shadow: none; }
    .dark .review-header { background: #2a2a3a; border-color: #444; }
    .dark #reviewContainer { background-color: #1e1e2f; }
    .dark .review-question { background: #2c2c3c; border-color: #444; }
    .dark .review-option { border-color: #555; }
    .dark .review-option.review-correct { background-color: #1a311b; border-color: #81c784; color: #c8e6c9; }
    .dark .review-option.review-incorrect { background-color: #3e1c1f; border-color: #ef9a9a; color: #ffcdd2; }
    .dark .review-status.correct { background-color: #1a311b; border-color: #4caf50; color: #c8e6c9; }
    .dark .review-status.incorrect { background-color: #3e1c1f; border-color: #f44336; color: #ffcdd2; }
    .dark .review-status.unanswered { background-color: #4a2c0f; border-color: #ff9800; color: #ffe0b2; }
    .dark .modal-content { background: #2c2c3c; border-color: #555; }
    .dark .close-modal:hover { color: #fff; }
    .dark .contact-admin-text { color: #aaa; }
    .dark .contact-admin-text a { color: #8ab4f8; }

    @media (max-width: 768px) {
        .site-header { flex-direction: column; text-align: center; gap: 5px; }
        .topbar { flex-wrap: wrap; justify-content: center; }
        .navigation-tabs { position: static; transform: none; order: 3; width: 100%; justify-content: center; margin-top: 10px; }
        .sidebar { top: 159px; height: calc(100% - 159px); } /* Adjust for potentially wrapped topbar */
        .sidebar-open .question-area { padding-right: 20px; } /* Disable padding push on mobile */
    }

    @media (max-width: 480px) {
        .btn-action span {
            display: none; /* Hide text on small screens */
        }
        .btn-action .fas {
            font-size: 1.1em; /* Make icon bigger */
            margin: 0 5px;
        }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="site-header">
        <img src="https://via.placeholder.com/150x50/3f51b5/ffffff?text=LOGO" alt="UPSChub Logo" class="site-logo">
        <div class="site-branding">
            <div class="site-title">UPSChub</div>
            <p class="site-tagline">Civil Services Exam Preparation</p>
        </div>
    </header>

    <header class="topbar">
      <div class="topbar-left-group">
        <div class="timer" id="timer">02:30:00</div>
        <div id="stopwatchWrapper">
          <span id="stopwatchDisplay">00:00:00</span>
          <div class="stopwatch-controls">
            <button id="stopwatchPlayPause" title="Play/Pause"><i class="fas fa-play"></i></button>
            <button id="stopwatchReset" title="Reset"><i class="fas fa-rotate-left"></i></button>
          </div>
        </div>
      </div>

      <div class="navigation-tabs">
        <button id="showMockTestTab" class="nav-tab active">Mock Test</button>
        <button id="showAnswerWritingTab" class="nav-tab locked">Answer Writing</button>
      </div>
      
      <div class="topbar-right-group">
        <div class="dark-mode-toggle">
          <span class="toggle-label" id="toggleLabel">Dark</span>
          <label class="toggle-switch"><input type="checkbox" id="darkModeToggle"><span class="toggle-slider"></span></label>
        </div>
        <button id="btnSubmitTest"><i class="fas fa-paper-plane"></i> Submit</button>
      </div>
    </header>

    <div class="main-content">
        <div id="mockTestWrapper" style="display: flex; width: 100%;">
            <button id="btnToggleSidebar" class="sidebar-toggle" title="Toggle Palette"><i class="fas fa-chevron-left"></i></button>
            <section class="question-area">
                <h2 class="question-header" id="questionNumber"></h2>
                <!-- Per-Question Timer Bar -->
                <div class="question-timer-bar-container">
                    <div id="questionTimerBar" class="question-timer-bar"></div>
                </div>
                <!-- End Per-Question Timer Bar -->
                <div class="question-content" id="questionText"></div>
                <ul class="options-list" id="optionsList"></ul>
            </section>
            <aside class="sidebar">
              <div class="sidebar-content">
                <div class="palette-title">Question Palette</div>
                <div class="question-palette" id="questionPalette"></div>
                <div class="palette-summary">
                    <div class="summary-item"><span id="summaryAnswered">0</span> Answered</div>
                    <div class="summary-item"><span id="summaryNotAnswered">0</span> Not Answered</div>
                    <div class="summary-item"><span id="summaryMarked">0</span> Marked Review</div>
                    <div class="summary-item"><span id="summaryNotVisited">0</span> Not Visited</div>
                </div>
                <div class="legend">
                    <div class="legend-title">Legend</div>
                    <div class="legend-item"><div class="legend-color answered"></div><span>Answered</span></div>
                    <div class="legend-item"><div class="legend-color not-answered"></div><span>Not Answered</span></div>
                    <div class="legend-item"><div class="legend-color marked"></div><span>Marked</span></div>
                    <div class="legend-item"><div class="legend-color marked-answered"></div><span>Marked & Answered</span></div>
                    <div class="legend-item"><div class="legend-color not-visited"></div><span>Not Visited</span></div>
                </div>
              </div>
            </aside>
        </div>
        
        <div id="resultScreenWrapper">
            <h2>Test Completed!</h2>
            <p>Your final score is:</p>
            <p id="finalScore">0/0</p>
            <div class="performance-analysis-container">
                <h3>Topic-wise Performance</h3>
                <div class="table-wrapper">
                    <table class="performance-table">
                        <thead><tr><th>Topic</th><th>Correct</th><th>Attempted</th><th>Accuracy</th></tr></thead>
                        <tbody id="performanceTableBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
            <div class="result-buttons">
              <button id="retestButton" class="submit-button btn-action"><i class="fas fa-redo"></i> Retest</button>
              <button id="reviewAnswersButton" class="submit-button btn-action"><i class="fas fa-search"></i> Review Answers</button>
            </div>
        </div>
        
        <div id="reviewScreenWrapper">
          <div class="review-header">
              <h2 class="review-title">Review Your Answers</h2>
              <button id="backToResultsBtn" class="submit-button btn-action"><i class="fas fa-arrow-left"></i> Back to Score</button>
          </div>
          <div id="reviewContainer"></div>
        </div>

        <div id="answerWritingWrapper">
           <div>
              <h2>Answer Writing Practice</h2>
              <p>This section is for practicing descriptive answers after the mock test.</p>
           </div>
        </div>
    </div>

    <div class="fixed-action-area" id="mcqFooter">
        <div class="action-buttons">
            <button class="btn-action" id="btnPrevQuestion"><i class="fas fa-arrow-left"></i><span>Previous</span></button>
            <button class="btn-action" id="btnClearResponse"><i class="fas fa-ban"></i><span>Clear</span></button>
            <button class="btn-action" id="btnMarkReview"><i class="fas fa-flag"></i><span>Mark</span></button>
            <button class="btn-action" id="btnSaveNext"><i class="fas fa-check"></i><span>Save</span></button>
        </div>
    </div>

    <div id="passwordModal" class="password-modal">
        <div class="modal-content">
            <span id="closeModal" class="close-modal">×</span>
            <h3>Enter Password to Retest</h3>
            <input type="password" id="passwordInput" placeholder="Enter password...">
            <div id="passwordError"></div>
            <button id="verifyPasswordButton" class="submit-button btn-action">Verify</button>
            <p class="contact-admin-text">Don't have a password? <a id="whatsappLink" href="#" target="_blank">Contact Admin</a></p>
        </div>
    </div>
  </div>
 <script>
    // ### CONFIGURATION ###
    const RETEST_PASSWORD = "UPSC2024";
    const TEST_DURATION_SECONDS = 150 * 60; // 2.5 hours
    const PER_QUESTION_TIME = 12; // 12 seconds per question
    const questions = [
        // Chapter: Union and its Territory (30 MCQs)
        { topic: "Union & Territory", text: "Article 1 of the Constitution describes India as a:", options: ["Federation of States", "Union of States", "Confederation of States", "Quasi-Federal State"], answer: 1 },
        { topic: "Union & Territory", text: "The power to admit into the Union of India new states which are not part of India is given to Parliament by:", options: ["Article 1", "Article 2", "Article 3", "Article 4"], answer: 1 },
        { topic: "Union & Territory", text: "A bill for altering state boundaries can be introduced in Parliament only with the prior recommendation of the:", options: ["Prime Minister", "President", "Speaker of Lok Sabha", "Concerned State Governor"], answer: 1 },
        { topic: "Union & Territory", text: "Is Parliament bound by the views of the state legislature on a bill altering its boundary?", options: ["Yes, always", "Yes, if passed by a special majority", "No, Parliament is not bound", "Only if it's a Union Territory"], answer: 2 },
        { topic: "Union & Territory", text: "Laws made for admission or establishment of new states (under Art 2) and formation of new states (under Art 3) are not to be considered as amendments under Article 368. This means they can be passed by:", options: ["Special majority", "Simple majority", "Special majority with ratification by states", "Referendum"], answer: 1 },
        { topic: "Union & Territory", text: "The integration of princely states was primarily overseen by:", options: ["Jawaharlal Nehru", "Sardar Vallabhbhai Patel", "B.R. Ambedkar", "Lord Mountbatten"], answer: 1 },
        { topic: "Union & Territory", text: "Which was the first commission appointed to examine the feasibility of reorganising states on a linguistic basis?", options: ["Fazl Ali Commission", "JVP Committee", "Dhar Commission", "States Reorganisation Commission"], answer: 2 },
        { topic: "Union & Territory", text: "The first linguistic state created in India was:", options: ["Kerala", "Tamil Nadu", "Andhra State", "Karnataka"], answer: 2 },
        { topic: "Union & Territory", text: "The States Reorganisation Act of 1956 created:", options: ["16 States and 3 UTs", "14 States and 6 UTs", "22 States and 9 UTs", "15 States and 5 UTs"], answer: 1 },
        { topic: "Union & Territory", text: "The state of Bombay was bifurcated into Maharashtra and Gujarat in:", options: ["1956", "1960", "1966", "1971"], answer: 1 },
        { topic: "Union & Territory", text: "The state of Haryana was carved out of Punjab in 1966 on the recommendation of the:", options: ["Fazl Ali Commission", "Shah Commission", "Sarkaria Commission", "Dhar Commission"], answer: 1 },
        { topic: "Union & Territory", text: "Sikkim was made a full-fledged state of the Union of India by which amendment?", options: ["35th Amendment", "36th Amendment", "42nd Amendment", "22nd Amendment"], answer: 1 },
        { topic: "Union & Territory", text: "The states of Chhattisgarh, Uttarakhand, and Jharkhand were created in:", options: ["1999", "2000", "2001", "2014"], answer: 1 },
        { topic: "Union & Territory", text: "The power to cede Indian territory to a foreign country requires:", options: ["The President's order", "The Prime Minister's approval", "A constitutional amendment", "A treaty signed by the executive"], answer: 2 },
        { topic: "Union & Territory", text: "The 'Territory of India' is a wider expression than the 'Union of India' because it includes:", options: ["States only", "UTs only", "States, UTs, and territories that may be acquired", "States and UTs only"], answer: 2 },
        { topic: "Union & Territory", text: "The USA, in contrast to India, is described as:", options: ["An indestructible union of indestructible states", "An indestructible union of destructible states", "A destructible union of indestructible states", "A destructible union of destructible states"], answer: 0 },
        { topic: "Union & Territory", text: "The exchange of enclaves with Bangladesh was actualized by the:", options: ["99th Amendment", "100th Amendment", "101st Amendment", "An executive order"], answer: 1 },
        { topic: "Union & Territory", text: "The integration of Hyderabad into the Indian Union was achieved through:", options: ["A referendum", "A treaty", "Police Action (Operation Polo)", "An Instrument of Accession"], answer: 2 },
        { topic: "Union & Territory", text: "The Zonal Councils, created by the States Reorganisation Act 1956, are:", options: ["Constitutional bodies", "Statutory bodies", "Executive bodies", "Ad-hoc bodies"], answer: 1 },
        { topic: "Union & Territory", text: "The chairman of the Zonal Councils is the:", options: ["Prime Minister", "President", "Union Home Minister", "Chief Minister by rotation"], answer: 2 },
        { topic: "Union & Territory", text: "Article 3 gives Parliament the power to form a new state by:", options: ["Separation of territory from any state", "Uniting two or more states", "Uniting any territory to a part of any state", "All of the above"], answer: 3 },
        { topic: "Union & Territory", text: "The Fazl Ali Commission (1953) accepted language as a basis for reorganisation but rejected the theory of:", options: ["'one language-one state'", "'administrative convenience'", "'financial viability'", "'national unity'"], answer: 0 },
        { topic: "Union & Territory", text: "Goa, Daman and Diu were liberated from Portuguese rule by:", options: ["Referendum", "Police action", "Treaty", "UN resolution"], answer: 1 },
        { topic: "Union & Territory", text: "The name 'Mysore' was changed to 'Karnataka' in:", options: ["1956", "1969", "1973", "2001"], answer: 2 },
        { topic: "Union & Territory", text: "The change of name of a state like from 'Orissa' to 'Odisha' requires:", options: ["Constitutional Amendment under Art 368", "An Act of Parliament by simple majority", "An executive order of the President", "A resolution by the state assembly only"], answer: 1 },
        { topic: "Union & Territory", text: "Which schedule of the Constitution deals with the allocation of seats in the Rajya Sabha to the states and UTs?", options: ["Third Schedule", "Fourth Schedule", "Fifth Schedule", "Sixth Schedule"], answer: 1 },
        { topic: "Union & Territory", text: "The North-Eastern Council was created by a separate Act of Parliament in:", options: ["1956", "1963", "1971", "1987"], answer: 2 },
        { topic: "Union & Territory", text: "Settlement of a boundary dispute with another country can be done by:", options: ["Constitutional Amendment", "Executive action", "Judicial order", "State legislature's resolution"], answer: 1 },
        { topic: "Union & Territory", text: "Can Parliament diminish the area of a state to an extent that it ceases to exist?", options: ["No, it violates the basic structure", "Yes, the power under Article 3 is absolute in this regard", "Only with Supreme Court permission", "Only with a 2/3rds majority in the state assembly"], answer: 1 },
        { topic: "Union & Territory", text: "Which Union Territory was recently merged with Dadra and Nagar Haveli?", options: ["Puducherry", "Lakshadweep", "Daman and Diu", "Andaman & Nicobar Islands"], answer: 2 },
        
        // Chapter: Citizenship (30 MCQs)
        { topic: "Citizenship", text: "Citizenship is covered in which Part of the Constitution?", options: ["Part I", "Part II", "Part III", "Part IV"], answer: 1 },
        { topic: "Citizenship", text: "The Constitution of India provides for what type of citizenship?", options: ["Single citizenship", "Dual citizenship", "Both a and b", "None of the above"], answer: 0 },
        { topic: "Citizenship", text: "The power to regulate the right of citizenship by law belongs to:", options: ["The President", "The Parliament", "The Supreme Court", "The State Legislatures"], answer: 1 },
        { topic: "Citizenship", text: "Which is NOT a way to acquire Indian citizenship under the Citizenship Act, 1955?", options: ["Birth", "Descent", "Acquiring property", "Naturalisation"], answer: 2 },
        { topic: "Citizenship", text: "Loss of Indian citizenship can occur through:", options: ["Renunciation", "Termination", "Deprivation", "All of the above"], answer: 3 },
        { topic: "Citizenship", text: "'Termination' of citizenship occurs when an Indian citizen:", options: ["Criticises the government", "Voluntarily acquires the citizenship of another country", "Stays abroad for 5 years continuously", "Commits a minor crime"], answer: 1 },
        { topic: "Citizenship", text: "An 'enemy alien' is a citizen of a country that:", options: ["India has no diplomatic relations with", "Is a communist state", "India is at war with", "Is not a member of the UN"], answer: 2 },
        { topic: "Citizenship", text: "Enemy aliens are denied protection against arrest and detention under which article?", options: ["Article 19", "Article 21", "Article 22", "Article 14"], answer: 2 },
        { topic: "Citizenship", text: "Which Fundamental Right is available ONLY to citizens of India?", options: ["Art 14 (Equality before law)", "Art 21 (Right to Life)", "Art 19 (Six Freedoms)", "Art 25 (Freedom of Religion)"], answer: 2 },
        { topic: "Citizenship", text: "Article 6 of the Constitution deals with the citizenship rights of persons who have:", options: ["Migrated to India from Pakistan", "Migrated to Pakistan from India", "Resided outside India", "Acquired foreign territory"], answer: 0 },
        { topic: "Citizenship", text: "The PIO (Persons of Indian Origin) and OCI (Overseas Citizen of India) card schemes were merged in which year?", options: ["2005", "2010", "2015", "2019"], answer: 2 },
        { topic: "Citizenship", text: "An Overseas Citizen of India (OCI) cardholder does NOT have the right to:", options: ["Own non-farm property in India", "Visit India without a visa", "Vote in elections", "Practice professions like medicine or law"], answer: 2 },
        { topic: "Citizenship", text: "The concept of 'domicile' for citizenship purposes implies:", options: ["Temporary residence", "A permanent home with the intention to reside indefinitely", "Place of birth", "Place of parents' residence"], answer: 1 },
        { topic: "Citizenship", text: "To be eligible for President of India, a person must be:", options: ["A citizen by birth only", "A citizen of India (birth or naturalised)", "A citizen resident in India for over 25 years", "A citizen born to Indian parents"], answer: 1 },
        { topic: "Citizenship", text: "In which country must the head of state be a 'natural-born' citizen?", options: ["UK", "France", "USA", "Canada"], answer: 2 },
        { topic: "Citizenship", text: "Citizenship by 'incorporation of territory' was relevant to the people of:", options: ["Goa, Daman & Diu", "Puducherry", "Sikkim", "All of the above"], answer: 3 },
        { topic: "Citizenship", text: "The National Register of Citizens (NRC) was first prepared in 1951 for which state?", options: ["West Bengal", "Punjab", "Assam", "Jammu & Kashmir"], answer: 2 },
        { topic: "Citizenship", text: "Article 9 of the Constitution explicitly states that a person who voluntarily acquires foreign citizenship:", options: ["Can hold dual citizenship", "Can vote in local elections", "Ceases to be a citizen of India", "Must re-apply after 5 years"], answer: 2 },
        { topic: "Citizenship", text: "The authority to grant or cancel citizenship under the Citizenship Act, 1955 lies with:", options: ["President's Office", "Ministry of External Affairs", "Ministry of Home Affairs", "The Supreme Court"], answer: 2 },
        { topic: "Citizenship", text: "The principle of *jus soli* (right of the soil) confers citizenship based on:", options: ["Place of birth", "Bloodline (ancestry)", "Naturalisation process", "Marriage to a citizen"], answer: 0 },
        { topic: "Citizenship", text: "The Citizenship (Amendment) Act, 1986, made citizenship by birth:", options: ["Easier to obtain", "More restrictive by adding parental citizenship criteria", "Automatic for everyone", "Dependent on religion"], answer: 1 },
        { topic: "Citizenship", text: "Pravasi Bharatiya Divas (NRI Day) is celebrated on January 9 to commemorate:", options: ["The start of the Ghadar movement", "Mahatma Gandhi's return from South Africa", "Enactment of the Citizenship Act", "L.M. Singhvi Committee report"], answer: 1 },
        { topic: "Citizenship", text: "A Non-Resident Indian (NRI) is an Indian citizen who is an 'ordinary resident' outside India as per:", options: ["Citizenship Act", "Income Tax Act", "FEMA Act", "Representation of the People Act"], answer: 1 },
        { topic: "Citizenship", text: "An OCI cardholder cannot acquire which type of property in India?", options: ["Residential property", "Commercial property", "Agricultural land or plantation property", "They can acquire any property"], answer: 2 },
        { topic: "Citizenship", text: "The right to hold certain public offices like President, VP, and Judge is reserved for:", options: ["All residents", "Citizens only", "Citizens by birth only", "OCI cardholders"], answer: 1 },
        { topic: "Citizenship", text: "The Citizenship Act, 1955 was enacted by Parliament using powers from which article?", options: ["Article 10", "Article 11", "Article 368", "The Preamble"], answer: 1 },
        { topic: "Citizenship", text: "A person born in India after Dec 3, 2004, is a citizen if:", options: ["Both parents are citizens, or one is a citizen and the other is not an illegal migrant", "Both parents were born in India", "The person registers with the local authority", "The person is of Indian ethnicity"], answer: 0 },
        { topic: "Citizenship", text: "The constitutional provisions on citizenship (Articles 5-11) are:", options: ["A permanent and exhaustive code", "Meant only for persons at the commencement of the Constitution", "Applicable to all future citizenship issues", "Repealed by the 1955 Act"], answer: 1 },
        { topic: "Citizenship", text: "Which committee recommended the grant of dual citizenship to Persons of Indian Origin (PIOs) of certain countries?", options: ["L.M. Singhvi Committee", "Sarkaria Commission", "Swaran Singh Committee", "Punchhi Commission"], answer: 0 },
        { topic: "Citizenship", text: "The Citizenship (Amendment) Act, 2019, provides a path to citizenship for specified religious minorities from which countries?", options: ["Pakistan, Bangladesh, Nepal", "Pakistan, Bangladesh, Afghanistan", "Pakistan, Afghanistan, Myanmar", "Pakistan, China, Bangladesh"], answer: 1 },

        // Chapter: Fundamental Rights (30 MCQs)
        { topic: "Fundamental Rights", text: "Fundamental Rights are contained in which Part of the Constitution?", options: ["Part II", "Part III", "Part IV", "Part IVA"], answer: 1 },
        { topic: "Fundamental Rights", text: "The concept of Fundamental Rights is borrowed from the constitution of:", options: ["UK", "USA (Bill of Rights)", "Ireland", "Canada"], answer: 1 },
        { topic: "Fundamental Rights", text: "Fundamental Rights are described as the _________ of the Indian Constitution.", options: ["Preamble", "Conscience", "Magna Carta", "Soul"], answer: 2 },
        { topic: "Fundamental Rights", text: "Fundamental Rights are:", options: ["Not justiciable", "Justiciable", "Justiciable only for citizens", "Justiciable only during an emergency"], answer: 1 },
        { topic: "Fundamental Rights", text: "Article 13 declares that laws inconsistent with Fundamental Rights shall be:", options: ["Void", "Valid", "Valid if passed by a 2/3 majority", "Voidable by the President"], answer: 0 },
        { topic: "Fundamental Rights", text: "The Right to Property was removed from the list of Fundamental Rights by the:", options: ["42nd Amendment", "44th Amendment", "24th Amendment", "1st Amendment"], answer: 1 },
        { topic: "Fundamental Rights", text: "Article 14 guarantees:", options: ["Equality before law and equal protection of laws", "Equality of opportunity", "Abolition of titles", "Prohibition of discrimination"], answer: 0 },
        { topic: "Fundamental Rights", text: "Article 17 deals with the abolition of:", options: ["Titles", "Slavery", "Untouchability", "Child Labour"], answer: 2 },
        { topic: "Fundamental Rights", text: "Freedom of the Press is implicitly guaranteed under:", options: ["Article 19(1)(a)", "Article 21", "Article 14", "Article 32"], answer: 0 },
        { topic: "Fundamental Rights", text: "Article 20 provides protection against:", options: ["Ex-post-facto law", "Double jeopardy", "Self-incrimination", "All of the above"], answer: 3 },
        { topic: "Fundamental Rights", text: "The Right to Education for children (6-14 years) was made a Fundamental Right under which Article?", options: ["Article 19", "Article 21A", "Article 29", "Article 45"], answer: 1 },
        { topic: "Fundamental Rights", text: "Article 23 prohibits:", options: ["Child labour", "Traffic in human beings and forced labour", "Untouchability", "Religious instruction in state schools"], answer: 1 },
        { topic: "Fundamental Rights", text: "Article 30 grants minorities the right to:", options: ["Establish and administer educational institutions of their choice", "Propagate their religion", "Get reserved government jobs", "Form separate political parties"], answer: 0 },
        { topic: "Fundamental Rights", text: "Which Article is called the 'heart and soul' of the Constitution by Dr. Ambedkar?", options: ["Article 14", "Article 19", "Article 21", "Article 32"], answer: 3 },
        { topic: "Fundamental Rights", text: "The writ of 'Habeas Corpus' literally means:", options: ["'We command'", "'To have the body of'", "'To forbid'", "'By what authority'"], answer: 1 },
        { topic: "Fundamental Rights", text: "Which Fundamental Rights cannot be suspended even during a National Emergency?", options: ["Article 19 and 20", "Article 20 and 21", "Article 21 and 22", "Article 14 and 19"], answer: 1 },
        { topic: "Fundamental Rights", text: "Article 33 empowers Parliament to restrict the Fundamental Rights of members of:", options: ["Armed forces", "Para-military forces", "Police forces", "All of the above"], answer: 3 },
        { topic: "Fundamental Rights", text: "The 'basic structure' doctrine of the Constitution was established by the Supreme Court in the:", options: ["Golaknath case", "Kesavananda Bharati case", "Minerva Mills case", "Shankari Prasad case"], answer: 1 },
        { topic: "Fundamental Rights", text: "In the Menaka Gandhi case (1978), the Supreme Court ruled that the procedure in Article 21 must be:", options: ["Quick and efficient", "As prescribed by legislature", "Fair, just, and reasonable", "Approved by the judiciary"], answer: 2 },
        { topic: "Fundamental Rights", text: "The 'Doctrine of Eclipse' applies to which kind of laws?", options: ["Post-Constitutional laws", "Pre-Constitutional laws", "Constitutional amendment acts", "All laws"], answer: 1 },
        { topic: "Fundamental Rights", text: "The writ of 'Mandamus' is issued to:", options: ["Produce a person", "Command a public official to perform his public duty", "Quash a judicial order", "Enquire into the legality of a claim to an office"], answer: 1 },
        { topic: "Fundamental Rights", text: "The writ jurisdiction of the High Courts under Article 226 is ________ than that of the Supreme Court under Article 32.", options: ["Narrower", "The same as", "Wider", "Less effective"], answer: 2 },
        { topic: "Fundamental Rights", text: "Article 18, which abolishes titles, does not prevent the state from conferring:", options: ["Hereditary titles", "Foreign titles", "Military and academic distinctions", "Noble titles like 'Rai Bahadur'"], answer: 2 },
        { topic: "Fundamental Rights", text: "The 'creamy layer' rule for OBC reservation was upheld by the Supreme Court in the:", options: ["Indra Sawhney case", "Golaknath case", "S.R. Bommai case", "Maneka Gandhi case"], answer: 0 },
        { topic: "Fundamental Rights", text: "The right to form co-operative societies was added as a Fundamental Right under Article 19 by the:", options: ["42nd Amendment", "44th Amendment", "86th Amendment", "97th Amendment"], answer: 3 },
        { topic: "Fundamental Rights", text: "The 'Right to be forgotten' is considered by the judiciary as a part of which right?", options: ["Right to Equality (Art 14)", "Right to Freedom of Speech (Art 19)", "Right to Life (Art 21)", "Right to Freedom of Religion (Art 25)"], answer: 2 },
        { topic: "Fundamental Rights", text: "The writ of 'Prohibition' is issued by a higher court to a lower court to:", options: ["Transfer a pending case", "Prevent the latter from exceeding its jurisdiction", "Quash an already passed order", "Enforce performance of a duty"], answer: 1 },
        { topic: "Fundamental Rights", text: "Fundamental rights available to both citizens and foreigners (except enemy aliens) include:", options: ["Article 15", "Article 16", "Article 19", "Article 21"], answer: 3 },
        { topic: "Fundamental Rights", text: "Which case led to the expansion of the meaning of 'State' under Article 12 to include bodies like LIC and ONGC?", options: ["Ujjam Bai v. State of U.P.", "R.D. Shetty v. International Airport Authority", "Sukhdev Singh v. Bhagatram", "Ajay Hasia v. Khalid Mujib"], answer: 3 },
        { topic: "Fundamental Rights", text: "The restriction of Fundamental Rights while Martial Law is in force in any area is provided under:", options: ["Article 32", "Article 33", "Article 34", "Article 35"], answer: 2 },
        
        // Chapter: Directive Principles of State Policy (DPSP) (30 MCQs)
        { topic: "DPSP", text: "DPSPs are enshrined in which Part of the Constitution?", options: ["Part III", "Part IV", "Part V", "Part II"], answer: 1 },
        { topic: "DPSP", text: "The concept of DPSP was borrowed from the Constitution of:", options: ["USA", "UK", "Ireland", "Canada"], answer: 2 },
        { topic: "DPSP", text: "Dr. B.R. Ambedkar described DPSPs as 'novel features' and compared them to:", options: ["Bill of Rights (USA)", "Instrument of Instructions (GoI Act 1935)", "Magna Carta (UK)", "Pillars of the Constitution"], answer: 1 },
        { topic: "DPSP", text: "Unlike Fundamental Rights, DPSPs are:", options: ["Justiciable", "Negative in character", "Non-justiciable", "Automatically enforced"], answer: 2 },
        { topic: "DPSP", text: "The DPSPs aim to establish a:", options: ["Political democracy", "Social and economic democracy", "Theocratic state", "Police state"], answer: 1 },
        { topic: "DPSP", text: "Article 40, reflecting Gandhian principles, directs the state to:", options: ["Prohibit cow slaughter", "Promote cottage industries", "Organize village panchayats", "Prohibit intoxicating drinks"], answer: 2 },
        { topic: "DPSP", text: "Which Article calls for a Uniform Civil Code (UCC) for all citizens?", options: ["Article 41", "Article 42", "Article 43", "Article 44"], answer: 3 },
        { topic: "DPSP", text: "The 86th Amendment changed the subject-matter of which DPSP article?", options: ["Article 40", "Article 44", "Article 45", "Article 48"], answer: 2 },
        { topic: "DPSP", text: "Which DPSP calls for the separation of the judiciary from the executive?", options: ["Article 49", "Article 50", "Article 51", "Article 48"], answer: 1 },
        { topic: "DPSP", text: "Article 51 directs the state to promote:", options: ["International peace and security", "Cottage industries", "Scientific temper", "A uniform civil code"], answer: 0 },
        { topic: "DPSP", text: "Which of the following is considered a 'Socialistic Principle' among DPSPs?", options: ["Article 44 (UCC)", "Article 40 (Panchayats)", "Article 39(a) (adequate means of livelihood)", "Article 50 (separation of judiciary)"], answer: 2 },
        { topic: "DPSP", text: "The 42nd Amendment Act of 1976 added which DPSP?", options: ["Article 39A (Free legal aid)", "Article 40 (Panchayats)", "Article 44 (UCC)", "Article 51 (International Peace)"], answer: 0 },
        { topic: "DPSP", text: "The 97th Amendment Act of 2011 added a DPSP related to:", options: ["Environment", "Free Legal Aid", "Co-operative societies (Article 43B)", "Monuments"], answer: 2 },
        { topic: "DPSP", text: "Who described DPSPs as a 'cheque on a bank, payable only when the resources of the bank permit'?", options: ["B.R. Ambedkar", "K.T. Shah", "Jawaharlal Nehru", "Granville Austin"], answer: 1 },
        { topic: "DPSP", text: "In which case did the Supreme Court hold that the 'Indian Constitution is founded on the bedrock of the balance between the FRs and DPSPs'?", options: ["Golaknath case", "Kesavananda Bharati case", "Minerva Mills case", "Champakam Dorairajan case"], answer: 2 },
        { topic: "DPSP", text: "The Maternity Benefit Act and the Minimum Wages Act are examples of legislation implementing:", options: ["Gandhian principles", "Liberal principles", "Socialistic principles", "International principles"], answer: 2 },
        { topic: "DPSP", text: "The establishment of the National Legal Services Authority (NALSA) is an implementation of:", options: ["Article 44", "Article 50", "Article 39A", "Article 51"], answer: 2 },
        { topic: "DPSP", text: "Article 38 directs the state to minimize inequalities in income, status, facilities and opportunities. This clause was added by the:", options: ["42nd Amendment", "44th Amendment", "24th Amendment", "86th Amendment"], answer: 1 },
        { topic: "DPSP", text: "Which directive outside Part IV instructs the Union to promote the spread of the Hindi language?", options: ["Article 335", "Article 350A", "Article 351", "Article 343"], answer: 2 },
        { topic: "DPSP", text: "Which DPSP relates to the protection of monuments and places of national importance?", options: ["Article 48", "Article 48A", "Article 49", "Article 50"], answer: 2 },
        { topic: "DPSP", text: "Article 43A, providing for participation of workers in management of industries, was added by the:", options: ["44th Amendment", "42nd Amendment", "97th Amendment", "Original Constitution"], answer: 1 },
        { topic: "DPSP", text: "The concept of 'equal pay for equal work' for both men and women is a:", options: ["Fundamental Right", "DPSP under Article 39", "Fundamental Duty", "Legal right under a separate act"], answer: 1 },
        { topic: "DPSP", text: "Which DPSP is based on liberal-intellectual principles?", options: ["To promote cottage industries", "To provide free legal aid", "To protect and improve the environment", "To prohibit slaughter of cows"], answer: 2 },
        { topic: "DPSP", text: "The original Article 45 provided for:", options: ["Early childhood care", "Free and compulsory education for children up to 14 years", "Education for weaker sections", "Adult education"], answer: 1 },
        { topic: "DPSP", text: "Who described DPSPs and FRs as the 'Conscience of the Constitution'?", options: ["B.R. Ambedkar", "Jawaharlal Nehru", "K.T. Shah", "Granville Austin"], answer: 3 },
        { topic: "DPSP", text: "The DPSPs resemble the 'Instrument of Instructions' from the:", options: ["Nehru Report, 1928", "Government of India Act, 1919", "Government of India Act, 1935", "Simon Commission Report"], answer: 2 },
        { topic: "DPSP", text: "Article 37 declares that the DPSPs, though not enforceable, are:", options: ["Fundamental in the governance of the country", "Optional for the government", "Irrelevant for law-making", "Superior to Fundamental Rights"], answer: 0 },
        { topic: "DPSP", text: "Article 46 directs the state to promote with special care the educational and economic interests of:", options: ["Religious minorities", "Linguistic minorities", "Women and children", "SCs, STs, and other weaker sections"], answer: 3 },
        { topic: "DPSP", text: "The DPSP to improve public health and prohibit intoxicating drinks is found in:", options: ["Article 46", "Article 47", "Article 48", "Article 48A"], answer: 1 },
        { topic: "DPSP", text: "In the initial Champakam Dorairajan case (1951), the Supreme Court ruled that:", options: ["DPSPs can override FRs", "FRs and DPSPs are equal", "Fundamental Rights would prevail over DPSPs in case of conflict", "Courts should harmonize both"], answer: 2 },
        
        // Chapter: Fundamental Duties (30 MCQs)
        { topic: "Fundamental Duties", text: "Fundamental Duties are mentioned in which part of the Indian Constitution?", options: ["Part III", "Part IV", "Part IV-A", "Part V"], answer: 2 },
        { topic: "Fundamental Duties", text: "The Fundamental Duties were added to the Constitution by the:", options: ["44th Amendment", "42nd Amendment", "52nd Amendment", "24th Amendment"], answer: 1 },
        { topic: "Fundamental Duties", text: "The Fundamental Duties were added on the recommendation of which committee?", options: ["Sarkaria Committee", "Swaran Singh Committee", "Fazl Ali Committee", "Rajamannar Committee"], answer: 1 },
        { topic: "Fundamental Duties", text: "Which article in the Indian Constitution deals with Fundamental Duties?", options: ["Article 51", "Article 51A", "Article 32", "Article 19"], answer: 1 },
        { topic: "Fundamental Duties", text: "The concept of Fundamental Duties in the Indian Constitution is borrowed from the Constitution of:", options: ["USA", "Former USSR (Soviet Union)", "UK", "Canada"], answer: 1 },
        { topic: "Fundamental Duties", text: "Originally, how many Fundamental Duties were added in 1976?", options: ["8", "10", "11", "12"], answer: 1 },
        { topic: "Fundamental Duties", text: "Which Fundamental Duty was added by the 86th Constitutional Amendment Act, 2002?", options: ["To protect public property", "To safeguard sovereignty of India", "To provide opportunities for education to one's child", "To respect the National Flag"], answer: 2 },
        { topic: "Fundamental Duties", text: "Currently, there are how many Fundamental Duties in the Constitution?", options: ["10", "11", "12", "13"], answer: 1 },
        { topic: "Fundamental Duties", text: "Like the Directive Principles, the Fundamental Duties are also:", options: ["Justiciable", "Non-justiciable", "Enforceable through writs", "Legally binding on the government"], answer: 1 },
        { topic: "Fundamental Duties", text: "To abide by the Constitution and respect its ideals, institutions, the National Flag, and the National Anthem is a:", options: ["Fundamental Right", "DPSP", "Fundamental Duty", "Legal Right"], answer: 2 },
        { topic: "Fundamental Duties", text: "Which of the following is a Fundamental Duty of an Indian citizen?", options: ["To cast vote in an election", "To pay taxes honestly", "To cherish and follow the noble ideals that inspired our national struggle for freedom", "To work for the welfare of the poor"], answer: 2 },
        { topic: "Fundamental Duties", text: "The protection of which of the following is a Fundamental Duty?", options: ["Village Panchayats", "Public property", "Scheduled Castes and Scheduled Tribes", "Minorities"], answer: 1 },
        { topic: "Fundamental Duties", text: "The Swaran Singh Committee recommended how many Fundamental Duties?", options: ["10", "11", "8", "9"], answer: 2 },
        { topic: "Fundamental Duties", text: "Which recommendation of the Swaran Singh Committee was NOT accepted?", options: ["Duty to respect the Constitution", "Duty to defend the country", "Duty to pay taxes", "Duty to protect public property"], answer: 2 },
        { topic: "Fundamental Duties", text: "The Fundamental Duties are applicable to:", options: ["Citizens only", "All persons (citizens and foreigners)", "Foreigners only", "OCI cardholders"], answer: 0 },
        { topic: "Fundamental Duties", text: "Which one of the following is NOT a Fundamental Duty?", options: ["To promote harmony and the spirit of common brotherhood", "To value and preserve the rich heritage of our composite culture", "To protect and improve the natural environment", "To not interfere in the work of the judiciary"], answer: 3 },
        { topic: "Fundamental Duties", text: "Developing the scientific temper, humanism and the spirit of inquiry and reform is a:", options: ["Fundamental Right", "DPSP", "Fundamental Duty", "Not mentioned in the Constitution"], answer: 2 },
        { topic: "Fundamental Duties", text: "The Fundamental Duty to 'defend the country and render national service when called upon to do so' is enshrined in:", options: ["Article 51A(a)", "Article 51A(b)", "Article 51A(c)", "Article 51A(d)"], answer: 3 },
        { topic: "Fundamental Duties", "text": "The Verma Committee (1999) was constituted to:", "options": ["Add new Fundamental Duties", "Make duties justiciable", "Identify the existence of legal provisions for the implementation of some Fundamental Duties", "Review the working of Fundamental Duties"], "answer": 2 },
        { topic: "Fundamental Duties", text: "Which Fundamental Duty relates to the rich heritage of our 'composite culture'?", options: ["Article 51A(e)", "Article 51A(f)", "Article 51A(g)", "Article 51A(h)"], answer: 1 },
        { topic: "Fundamental Duties", text: "Which part of the Constitution did the Swaran Singh Committee suggest incorporating the duties into?", options: ["A separate chapter on duties", "As a new DPSP", "In Part III as a restriction on rights", "In the Preamble"], answer: 0 },
        { topic: "Fundamental Duties", text: "The Parliament can enforce Fundamental Duties through:", options: ["Constitutional Amendments", "Presidential Orders", "Supreme Court judgements", "Suitable legislation"], answer: 3 },
        { topic: "Fundamental Duties", text: "The Prevention of Insults to National Honour Act, 1971, is an example of a law that helps enforce a Fundamental Duty relating to:", options: ["Public property", "Composite culture", "National Flag and Anthem", "Sovereignty of India"], answer: 2 },
        { topic: "Fundamental Duties", text: "Which duty calls upon citizens to 'renounce practices derogatory to the dignity of women'?", options: ["Article 51A(c)", "Article 51A(d)", "Article 51A(e)", "Article 51A(f)"], answer: 2 },
        { topic: "Fundamental Duties", text: "The duty to 'strive towards excellence in all spheres of individual and collective activity' is found in:", options: ["Article 51A(i)", "Article 51A(j)", "Article 51A(k)", "It's not a duty"], answer: 1 },
        { topic: "Fundamental Duties", text: "The inclusion of Fundamental Duties was inspired by the need to balance rights with:", options: ["Privileges", "Responsibilities", "Powers", "Freedoms"], answer: 1 },
        { topic: "Fundamental Duties", text: "A key criticism of Fundamental Duties is their:", options: ["Justiciable nature", "Complex and technical language", "Inclusion of too many duties", "Focus on Western values"], answer: 1 },
        { topic: "Fundamental Duties", text: "Which one of the following is a Fundamental Duty?", options: ["To organize village panchayats", "To secure a uniform civil code", "To uphold and protect the sovereignty, unity, and integrity of India", "To separate judiciary from the executive"], answer: 2 },
        { topic: "Fundamental Duties", text: "The duty to provide educational opportunities for children (6-14 years) is cast upon:", options: ["The State only", "The Society", "Every parent or guardian", "Private educational institutions"], answer: 2 },
        { topic: "Fundamental Duties", text: "The Supreme Court has held that Fundamental Duties can be used by courts to:", options: ["Strike down laws", "Determine the constitutionality of a law", "Issue writs against citizens", "Create new rights"], answer: 1 },
    ];
    
    // ### GLOBAL STATE & DOM ELEMENTS ###
    let state = {};
    let timerInterval;
    let onTimerEnd; 
    let timeLeft = TEST_DURATION_SECONDS;
    let isTestCompleted = false;
    let performanceChart = null; 
    let stopwatchInterval = null;
    let stopwatchTime = 0;
    let isStopwatchRunning = false;

    const dom = {
      body: document.body,
      mockTestWrapper: document.getElementById('mockTestWrapper'),
      resultScreenWrapper: document.getElementById('resultScreenWrapper'),
      reviewScreenWrapper: document.getElementById('reviewScreenWrapper'),
      answerWritingWrapper: document.getElementById('answerWritingWrapper'),
      mcqFooter: document.getElementById('mcqFooter'),
      passwordModal: document.getElementById('passwordModal'),
      questionArea: document.querySelector('.question-area'),
      questionText: document.getElementById('questionText'),
      questionNumber: document.getElementById('questionNumber'),
      questionTimerBar: document.getElementById('questionTimerBar'),
      optionsList: document.getElementById('optionsList'),
      questionPalette: document.getElementById('questionPalette'),
      btnSubmitTest: document.getElementById('btnSubmitTest'),
      btnPrevQuestion: document.getElementById('btnPrevQuestion'),
      btnSaveNext: document.getElementById('btnSaveNext'),
      btnMarkReview: document.getElementById('btnMarkReview'),
      btnClearResponse: document.getElementById('btnClearResponse'),
      timer: document.getElementById('timer'),
      darkModeToggle: document.getElementById('darkModeToggle'),
      toggleLabel: document.getElementById('toggleLabel'),
      sidebarToggle: document.getElementById('btnToggleSidebar'),
      summaryAnswered: document.getElementById('summaryAnswered'),
      summaryNotAnswered: document.getElementById('summaryNotAnswered'),
      summaryMarked: document.getElementById('summaryMarked'),
      summaryNotVisited: document.getElementById('summaryNotVisited'),
      performanceTableBody: document.getElementById('performanceTableBody'),
      reviewContainer: document.getElementById('reviewContainer'),
      finalScore: document.getElementById('finalScore'),
      retestButton: document.getElementById('retestButton'),
      reviewAnswersButton: document.getElementById('reviewAnswersButton'),
      backToResultsBtn: document.getElementById('backToResultsBtn'),
      closeModal: document.getElementById('closeModal'),
      verifyPasswordButton: document.getElementById('verifyPasswordButton'),
      passwordInput: document.getElementById('passwordInput'),
      passwordError: document.getElementById('passwordError'),
      whatsappLink: document.getElementById('whatsappLink'),
      showMockTestTab: document.getElementById('showMockTestTab'),
      showAnswerWritingTab: document.getElementById('showAnswerWritingTab'),
      stopwatchWrapper: document.getElementById('stopwatchWrapper'),
      stopwatchDisplay: document.getElementById('stopwatchDisplay'),
      stopwatchPlayPause: document.getElementById('stopwatchPlayPause'),
      stopwatchReset: document.getElementById('stopwatchReset'),
    };
    
    // ### INITIALIZATION & STATE MANAGEMENT ###
    function resetState() {
        state = { current: 0, answers: Array(questions.length).fill(null), marked: Array(questions.length).fill(false), visited: Array(questions.length).fill(false) };
    }
    
    function initTest() {
      resetState();
      timeLeft = TEST_DURATION_SECONDS;
      isTestCompleted = false;
      dom.showAnswerWritingTab.classList.add('locked');
      state.visited[0] = true;
      resetStopwatch();
      setView('mockTest');
      loadQuestion(0);
      startTimer();
    }

    // ### VIEW MANAGEMENT ###
    function setView(viewName) {
        dom.mockTestWrapper.style.display = 'none';
        dom.resultScreenWrapper.style.display = 'none';
        dom.reviewScreenWrapper.style.display = 'none';
        dom.answerWritingWrapper.style.display = 'none';
        dom.mcqFooter.style.display = 'none';
        dom.sidebarToggle.style.display = 'none';
        dom.btnSubmitTest.style.display = 'none';
        dom.timer.style.display = 'none';
        dom.stopwatchWrapper.style.display = 'none';
        dom.showMockTestTab.classList.remove('active');
        dom.showAnswerWritingTab.classList.remove('active');

        if (viewName === 'mockTest') {
            dom.showMockTestTab.classList.add('active');
            dom.timer.style.display = 'block';
            if (isTestCompleted) {
                const scoreText = localStorage.getItem('lastScore');
                const topicStats = JSON.parse(localStorage.getItem('topicStats'));
                showResultScreen(scoreText, topicStats);
            } else {
                dom.mockTestWrapper.style.display = 'flex';
                dom.mcqFooter.style.display = 'block';
                dom.sidebarToggle.style.display = 'flex';
            }
        } else if (viewName === 'answerWriting') {
            if (dom.showAnswerWritingTab.classList.contains('locked')) return;
            dom.showAnswerWritingTab.classList.add('active');
            dom.stopwatchWrapper.style.display = 'flex';
            dom.answerWritingWrapper.style.display = 'flex';
        }
    }

    // ### TEST LOGIC ###
    function loadQuestion(index) {
        state.current = index;
        if (!state.visited[index]) { state.visited[index] = true; }
        
        startQuestionTimer();
        
        const q = questions[index];
        dom.questionNumber.textContent = `Question ${index + 1}`;
        dom.questionText.textContent = q.text;
        dom.optionsList.innerHTML = '';
        q.options.forEach((opt, i) => {
            const li = document.createElement('li');
            li.className = 'option';
            if (state.answers[index] === i) li.classList.add('selected');
            li.innerHTML = `<span class="option-radio"></span><span class="option-text">${opt}</span>`;
            li.onclick = () => selectOption(i);
            dom.optionsList.appendChild(li);
        });

        dom.btnSubmitTest.style.display = (state.current === questions.length - 1) ? 'flex' : 'none';
        updatePalette();
        updateNavigationButtons();
    }

    function selectOption(optIndex) {
        state.answers[state.current] = optIndex;
        dom.optionsList.querySelectorAll('.option').forEach((opt, i) => opt.classList.toggle('selected', i === optIndex));
        updatePalette();
    }

    function handleSaveAndNext() {
      if (isTestCompleted) return; // Prevent action if test is already finished
      if (state.current < questions.length - 1) {
          loadQuestion(state.current + 1);
      } else {
          submitTest(); // Automatically submit on last question
      }
    }

    function handleMarkAndNext() {
      if (isTestCompleted) return;
      state.marked[state.current] = true;
      handleSaveAndNext(); // Mark and move to next
    }
    
    function handleClearResponse() {
        state.answers[state.current] = null;
        dom.optionsList.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
        updatePalette(); // Just update the palette
    }

    function submitTest() {
        if(isTestCompleted) return;
        
        const isAutoSubmit = state.current === questions.length - 1;
        if (!isAutoSubmit) {
             const confirmed = confirm('Are you sure you want to submit the test?');
             if (!confirmed) return;
        }

        stopTimer();
        isTestCompleted = true;
        dom.showAnswerWritingTab.classList.remove('locked');
        
        const score = state.answers.reduce((acc, ans, i) => (ans === questions[i].answer ? acc + 1 : acc), 0);
        const scoreText = `${score} / ${questions.length}`;
        const topicStats = calculateTopicStats();
        
        localStorage.setItem('testTaken', 'true');
        localStorage.setItem('lastScore', scoreText);
        localStorage.setItem('lastAnswers', JSON.stringify(state.answers));
        localStorage.setItem('topicStats', JSON.stringify(topicStats));
        setView('mockTest');
    }
    
    // ### UI & UX FUNCTIONS ###
    function updatePalette() {
        dom.questionPalette.innerHTML = '';
        let answered = 0, notAnswered = 0, marked = 0, notVisited = 0;
        
        questions.forEach((_, i) => {
            const btn = document.createElement('div');
            btn.className = 'question-number';
            const isAnswered = state.answers[i] !== null;
            const isMarked = state.marked[i];
            if(isAnswered && isMarked) btn.classList.add('marked-answered');
            else if(isAnswered) btn.classList.add('answered');
            else if(isMarked) btn.classList.add('marked');
            else if(state.visited[i]) btn.classList.add('not-answered');
            else btn.classList.add('not-visited');
            if (i === state.current) btn.classList.add('current');
            if (isAnswered) answered++;
            if (isMarked) marked++;
            if (!state.visited[i]) notVisited++;
            btn.textContent = i + 1;
            btn.onclick = () => { if (!isTestCompleted) loadQuestion(i); };
            dom.questionPalette.appendChild(btn);
        });

        notAnswered = state.visited.filter((v, i) => v && state.answers[i] === null && !state.marked[i]).length;
        dom.summaryAnswered.textContent = answered;
        dom.summaryMarked.textContent = marked;
        dom.summaryNotAnswered.textContent = notAnswered;
        dom.summaryNotVisited.textContent = notVisited;
    }

    function updateNavigationButtons() {
        dom.btnPrevQuestion.style.display = state.current === 0 ? 'none' : 'flex';
    }

    function formatTime(totalSeconds) {
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
          if (timeLeft <= 0) {
              clearInterval(timerInterval);
              alert("Time's up! The test will be submitted automatically.");
              submitTest();
              return;
          }
          timeLeft--;
          dom.timer.textContent = formatTime(timeLeft);
      }, 1000);
    }
    
    function startQuestionTimer() {
        if (onTimerEnd) {
            dom.questionTimerBar.removeEventListener('transitionend', onTimerEnd);
        }
        onTimerEnd = () => handleSaveAndNext();

        dom.questionTimerBar.style.transition = 'none';
        dom.questionTimerBar.style.width = '100%';
        dom.questionTimerBar.offsetHeight; 
        dom.questionTimerBar.style.transition = `width ${PER_QUESTION_TIME}s linear`;
        dom.questionTimerBar.style.width = '0%';
        dom.questionTimerBar.addEventListener('transitionend', onTimerEnd, { once: true });
    }

    function stopTimer() { 
        clearInterval(timerInterval);
        if(onTimerEnd) {
            dom.questionTimerBar.removeEventListener('transitionend', onTimerEnd);
            // Also stop the animation immediately
            dom.questionTimerBar.style.transition = 'none';
        }
    }
    
    function toggleStopwatch() {
        const icon = dom.stopwatchPlayPause.querySelector('i');
        if (isStopwatchRunning) {
            clearInterval(stopwatchInterval);
            icon.classList.replace('fa-pause', 'fa-play');
        } else {
            stopwatchInterval = setInterval(() => {
                stopwatchTime++;
                dom.stopwatchDisplay.textContent = formatTime(stopwatchTime);
            }, 1000);
            icon.classList.replace('fa-play', 'fa-pause');
        }
        isStopwatchRunning = !isStopwatchRunning;
    }

    function resetStopwatch() {
        clearInterval(stopwatchInterval);
        isStopwatchRunning = false;
        stopwatchTime = 0;
        dom.stopwatchDisplay.textContent = formatTime(0);
        if(dom.stopwatchPlayPause.querySelector('i')) {
           dom.stopwatchPlayPause.querySelector('i').classList.replace('fa-pause', 'fa-play');
        }
    }

    function toggleDarkMode(isDark) {
        dom.body.classList.toggle('dark', isDark);
        dom.toggleLabel.textContent = isDark ? 'Light' : 'Dark';
        if (isTestCompleted && performanceChart) {
            const topicStats = JSON.parse(localStorage.getItem('topicStats'));
            renderPerformanceChart(topicStats);
        }
    }
    
    // ### RESULT & REVIEW FUNCTIONS ###
    function calculateTopicStats() {
      const topicStats = {};
      questions.forEach((q, i) => {
        if (!topicStats[q.topic]) { topicStats[q.topic] = { correct: 0, attempted: 0 }; }
        if (state.answers[i] !== null) {
          topicStats[q.topic].attempted++;
          if (state.answers[i] === q.answer) { topicStats[q.topic].correct++; }
        }
      });
      return topicStats;
    }

    function showResultScreen(scoreText, topicStats) {
        dom.mockTestWrapper.style.display = 'none';
        dom.reviewScreenWrapper.style.display = 'none';
        dom.resultScreenWrapper.style.display = 'flex';
        dom.finalScore.textContent = scoreText;
        populatePerformanceTable(topicStats);
        setTimeout(() => renderPerformanceChart(topicStats), 100);
    }

    function populatePerformanceTable(topicStats) {
        dom.performanceTableBody.innerHTML = '';
        if (!topicStats) return;
        Object.keys(topicStats).forEach(topicName => {
            const stats = topicStats[topicName];
            const accuracy = stats.attempted > 0 ? Math.round((stats.correct / stats.attempted) * 100) : 0;
            const barColor = accuracy > 75 ? '#4caf50' : accuracy >= 40 ? '#ff9800' : '#f44336';
            const row = `
                <tr>
                    <td>${topicName}</td>
                    <td>${stats.correct}</td>
                    <td>${stats.attempted}</td>
                    <td>
                        <div class="accuracy-bar-container">
                            <div class="accuracy-bar" style="width: ${accuracy}%; background-color: ${barColor};"></div>
                            <span class="accuracy-text">${accuracy}%</span>
                        </div>
                    </td>
                </tr>`;
            dom.performanceTableBody.innerHTML += row;
        });
    }

    function renderPerformanceChart(topicStats) {
      if (performanceChart) performanceChart.destroy();
      if (!topicStats) return;
      
      const isDark = dom.body.classList.contains('dark');
      const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      const textColor = isDark ? 'rgba(255, 255, 255, 0.7)' : '#666';

      const labels = Object.keys(topicStats);
      const marksData = labels.map(label => topicStats[label].correct);
      const accuracyData = labels.map(label => {
        const stats = topicStats[label];
        return stats.attempted > 0 ? Math.round((stats.correct / stats.attempted) * 100) : 0;
      });

      const ctx = document.getElementById('performanceChart').getContext('2d');
      performanceChart = new Chart(ctx, {
          type: 'bar', data: { labels: labels, datasets: [{ label: 'Correct Answers (Marks)', data: marksData, backgroundColor: '#3f51b5', yAxisID: 'y' }, { label: 'Accuracy (%)', data: accuracyData, type: 'line', borderColor: '#4caf50', tension: 0.1, yAxisID: 'y1' }] },
          options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, scales: { x: { ticks: { color: textColor }, grid: { color: gridColor } }, y: { type: 'linear', position: 'left', title: { display: true, text: 'Correct Answers', color: textColor }, ticks: { color: textColor, precision: 0 }, grid: { color: gridColor }, beginAtZero: true }, y1: { type: 'linear', position: 'right', min: 0, max: 100, title: { display: true, text: 'Accuracy (%)', color: textColor }, ticks: { color: textColor }, grid: { drawOnChartArea: false } } }, plugins: { legend: { labels: { color: textColor } } } }
      });
    }
    
    function showReviewScreen() {
      dom.resultScreenWrapper.style.display = 'none';
      dom.reviewScreenWrapper.style.display = 'flex';
      populateReviewScreen();
    }

    function populateReviewScreen() {
        dom.reviewContainer.innerHTML = '';
        const userAnswers = JSON.parse(localStorage.getItem('lastAnswers'));
        questions.forEach((q, index) => {
            const userAnswer = userAnswers[index];
            const correctAnswer = q.answer;
            const isCorrect = userAnswer === correctAnswer;
            const questionDiv = document.createElement('div');
            questionDiv.className = 'review-question';
            let optionsHTML = '';
            q.options.forEach((opt, optIndex) => {
                let classes = 'review-option';
                let icon = '<i class="far fa-circle"></i>';
                if (optIndex === correctAnswer) { classes += ' review-correct'; icon = '<i class="fas fa-check-circle"></i>'; }
                if (optIndex === userAnswer && !isCorrect) { classes += ' review-incorrect'; icon = '<i class="fas fa-times-circle"></i>'; }
                optionsHTML += `<li class="${classes}">${icon}<span>${opt}</span></li>`;
            });
            let statusHTML = '';
            if(userAnswer === null) { statusHTML = '<div class="review-status unanswered">Status: Unanswered</div>'; } 
            else if (isCorrect) { statusHTML = '<div class="review-status correct">Status: Correct</div>'; } 
            else { statusHTML = '<div class="review-status incorrect">Status: Incorrect</div>'; }
            questionDiv.innerHTML = `<h4>Q${index + 1}: ${q.text}</h4><ul class="review-option-list">${optionsHTML}</ul>${statusHTML}`;
            dom.reviewContainer.appendChild(questionDiv);
        });
    }

    function handleRetest() {
      if (dom.passwordInput.value === RETEST_PASSWORD) {
          localStorage.clear();
          dom.passwordModal.style.display = 'none';
          dom.passwordInput.value = '';
          dom.passwordError.textContent = '';
          initTest();
      } else {
          dom.passwordError.textContent = 'Incorrect password.';
      }
    }


    // ### EVENT LISTENERS ###
    document.addEventListener('DOMContentLoaded', () => {
        const phone = "918658567727";
        const message = "I need the password for the mock test.";
        dom.whatsappLink.href = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(message)}`;
        const storedTheme = localStorage.getItem('theme');
        if (storedTheme === 'dark') {
            dom.darkModeToggle.checked = true;
            toggleDarkMode(true);
        }
        if (localStorage.getItem('testTaken') === 'true') {
            isTestCompleted = true;
            dom.showAnswerWritingTab.classList.remove('locked');
            setView('mockTest');
        } else {
            initTest();
        }
    });
    
    dom.btnSaveNext.addEventListener('click', handleSaveAndNext);
    dom.btnPrevQuestion.addEventListener('click', () => { if(state.current > 0 && !isTestCompleted) loadQuestion(state.current - 1); });
    dom.btnMarkReview.addEventListener('click', handleMarkAndNext);
    dom.btnClearResponse.addEventListener('click', handleClearResponse);
    dom.btnSubmitTest.addEventListener('click', submitTest);
    dom.sidebarToggle.addEventListener('click', () => dom.body.classList.toggle('sidebar-open'));
    dom.darkModeToggle.addEventListener('change', (e) => {
      toggleDarkMode(e.target.checked)
      localStorage.setItem('theme', e.target.checked ? 'dark' : 'light');
    });
    dom.retestButton.addEventListener('click', () => { dom.passwordModal.style.display = 'flex'; });
    dom.reviewAnswersButton.addEventListener('click', showReviewScreen);
    dom.backToResultsBtn.addEventListener('click', () => setView('mockTest'));
    dom.closeModal.addEventListener('click', () => { dom.passwordModal.style.display = 'none'; });
    dom.verifyPasswordButton.addEventListener('click', handleRetest);
    dom.stopwatchPlayPause.addEventListener('click', toggleStopwatch);
    dom.stopwatchReset.addEventListener('click', resetStopwatch);
    dom.showMockTestTab.addEventListener('click', () => setView('mockTest'));
    dom.showAnswerWritingTab.addEventListener('click', () => setView('answerWriting'));
  </script>
</body>
</html>
